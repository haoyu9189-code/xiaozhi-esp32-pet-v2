# 更新日志 / Changelog

本文档记录小智ESP32项目的重要更新和变更。

---

## [未发布] - 2026-01-26

### 新增功能 ✨

#### 环境对白系统
- **实现可爱的环境对白系统**：宠物会在特定时间和事件时自动说话，增强互动体验
  - 📁 新增文件：
    - `main/pet/dialogue_texts.h` - 对白文本库（240行，包含所有对白文本）
    - `main/pet/ambient_dialogue.h` - 对白系统接口定义
    - `main/pet/ambient_dialogue.cc` - 对白系统实现（518行）

  - 🎭 对白类别：
    - **事件反应**（9种）：金币出现、捡到金币、便便生成、踩到便便、开始吃饭、吃饱、开始洗澡、洗完澡
    - **时间问候**（4种）：早上好、下午好、傍晚好、晚安（根据时间段自动触发）
    - **心情自言自语**（5种）：饥饿、很脏、心情不好、心情很好、状态良好
    - **节日祝福**（11个节日）：元旦、春节、元宵节、情人节、清明节、劳动节、儿童节、端午节、中秋节、国庆节、万圣节、圣诞节

  - ⚙️ 系统特性：
    - **智能触发频率**：事件50%概率触发，时间问候每小时1-2次，心情自言自语每小时1次
    - **自动显示时长**：根据文本长度智能调整（短文本3秒，长文本5秒）
    - **防刷屏机制**：同类事件5分钟冷却，时间问候1小时冷却，心情30分钟冷却，节日3小时冷却
    - **风格多样化**：每个事件有5-7条不同风格的对白（俏皮、呆萌、温柔、吐槽混合），随机选择
    - **纯文本显示**：使用现有字幕系统，显示在底部，自动隐藏状态栏

  - 🔧 集成修改：
    - `main/pet/pet_state.cc` - 在吃饭/洗澡动作时触发对白
    - `main/pet/scene_items.cc` - 在金币/便便事件时触发对白
    - `main/boards/waveshare-c6-lcd-1.69/esp32-c6-lcd-1.69.cc` - 初始化对白系统
    - `main/application.cc` - 每分钟调用Tick()更新对白系统

#### 记忆与个性系统（用户添加）
- **对话记忆系统**：支持短期和长期记忆管理
  - 新增 `ConversationManager` - 对话管理器
  - 新增 `PersonalityEvolver` - 个性进化系统
  - 集成到 `application.cc` 中，在对话结束时自动处理记忆转换

### 优化改进 🔧

#### 宠物系统优化
- **踩便便惩罚机制调整**
  - 踩到便便时同时降低**清洁度-10**和**心情值-10**（之前只降低清洁度）
  - 修改文件：`main/pet/pet_state.cc:291-295`

- **便便生成频率大幅提升**
  - 生成间隔从45-75分钟（平均60分钟）调整为**10-20分钟（平均15分钟）**，频率提升4倍
  - 每日便便上限从3个提升到12个
  - 便便触发饥饿阈值从90降低到0（只要不是完全空腹就会产生）
  - 修改文件：`main/pet/scene_items.cc:32-35`, `main/pet/scene_items.h:25-26`

- **拾取距离优化**
  - 金币拾取距离：从60px调整为**30px**
  - 便便踩踏距离：从40px调整为**30px**
  - 降低拾取距离让用户更容易看到金币/便便再触发交互
  - 修改文件：`main/pet/scene_items.h:20-21`

### 调试改进 🐛

- **便便生成调试日志**
  - 每10分钟输出一次便便生成状态日志
  - 显示当前饥饿值、便便数量、每日生成次数、下次生成倒计时
  - 修改文件：`main/pet/scene_items.cc:132-145`

---

## 贡献者
- Claude Code (Anthropic) - 环境对白系统实现、宠物系统优化
- 用户 - 记忆系统集成、功能需求设计

---

## 说明
- 本更新日志遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/) 规范
- 版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范
