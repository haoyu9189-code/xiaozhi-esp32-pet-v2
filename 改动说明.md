# Waveshare ESP32-C6-LCD-1.69 æ”¹åŠ¨è¯´æ˜

> æœ¬æ–‡æ¡£æ€»ç»“äº†é’ˆå¯¹ waveshare-c6-lcd-1.69 å¼€å‘æ¿çš„æ‰€æœ‰å®šåˆ¶æ”¹åŠ¨

---

## å¯¼å…¥æ–°åŠ¨ç”»æ•°æ®å·¥ä½œæµ

æ”¶åˆ°æ–°çš„åŠ¨ç”»æ•°æ®åï¼ˆ`gifs/frames.bin`, `gifs/backgrounds.bin`, `gifs/index.json`ï¼‰ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼š

### æ­¥éª¤ 1: åˆ†æ index.json (ä¸€é”®åˆ†æè„šæœ¬)

```powershell
# åœ¨ PowerShell ä¸­æ‰§è¡Œï¼Œè‡ªåŠ¨åˆ†ææ‰€æœ‰é…ç½®
cd D:\xiaozhi\xiaozhi-esp32-main
$json = Get-Content gifs/index.json | ConvertFrom-Json

Write-Host "==================== æ•°æ®åˆ†æ ====================" -ForegroundColor Cyan

# åŠ¨ç”»åŸºæœ¬ä¿¡æ¯
Write-Host "`nã€åŠ¨ç”»ä¿¡æ¯ã€‘" -ForegroundColor Yellow
Write-Host "  å°ºå¯¸: $($json.width) x $($json.height)"
Write-Host "  é¢œè‰²æ•°: $($json.colors)"
Write-Host "  æ¯å¸§å¤§å°: $($json.frame_size) å­—èŠ‚"
Write-Host "  æ€»å¸§æ•°: $($json.total_frames)"
Write-Host "  åŠ¨ç”»æ•°: $($json.animations.Count)"
$json.animations | ForEach-Object { Write-Host "    - $($_.name): å¸§ $($_.start)-$($_.start + $_.count - 1) ($($_.count)å¸§)" }

# èƒŒæ™¯ä¿¡æ¯
Write-Host "`nã€èƒŒæ™¯ä¿¡æ¯ã€‘" -ForegroundColor Yellow
Write-Host "  å°ºå¯¸: $($json.bg_width) x $($json.bg_height)"
Write-Host "  æ¯å¸§å¤§å°: $($json.bg_frame_size) å­—èŠ‚"
Write-Host "  èƒŒæ™¯æ•°: $($json.backgrounds.Count)"
$json.backgrounds | ForEach-Object { Write-Host "    - [$($_.frame)] $($_.name)" }

# èƒŒæ™¯è‰²èŒƒå›´è®¡ç®—
$frames = $json.frames
$r = $frames.bg_color_rgb | ForEach-Object { $_[0] }
$g = $frames.bg_color_rgb | ForEach-Object { $_[1] }
$b = $frames.bg_color_rgb | ForEach-Object { $_[2] }

$rMin = ($r | Measure-Object -Minimum).Minimum
$rMax = ($r | Measure-Object -Maximum).Maximum
$gMin = ($g | Measure-Object -Minimum).Minimum
$gMax = ($g | Measure-Object -Maximum).Maximum
$bMin = ($b | Measure-Object -Minimum).Minimum
$bMax = ($b | Measure-Object -Maximum).Maximum

Write-Host "`nã€èƒŒæ™¯è‰²èŒƒå›´ (åŸå§‹)ã€‘" -ForegroundColor Yellow
Write-Host "  RGB888: R($rMin-$rMax), G($gMin-$gMax), B($bMin-$bMax)"

# å¤–æ‰© 20%
$rRange = $rMax - $rMin; $rMinE = [Math]::Max(0, $rMin - $rRange * 0.2); $rMaxE = [Math]::Min(255, $rMax + $rRange * 0.2)
$gRange = $gMax - $gMin; $gMinE = [Math]::Max(0, $gMin - $gRange * 0.2); $gMaxE = [Math]::Min(255, $gMax + $gRange * 0.2)
$bRange = $bMax - $bMin; $bMinE = [Math]::Max(0, $bMin - $bRange * 0.2); $bMaxE = [Math]::Min(255, $bMax + $bRange * 0.2)

Write-Host "`nã€èƒŒæ™¯è‰²èŒƒå›´ (å¤–æ‰©20%)ã€‘" -ForegroundColor Yellow
Write-Host "  RGB888: R($([int]$rMinE)-$([int]$rMaxE)), G($([int]$gMinE)-$([int]$gMaxE)), B($([int]$bMinE)-$([int]$bMaxE))"

# Flash å¸ƒå±€
$animSize = $json.total_frames * $json.frame_size
$bgSize = $json.backgrounds.Count * $json.bg_frame_size
$bgOffset = $animSize

Write-Host "`n==================== éœ€è¦æ›´æ–°çš„ä»£ç  ====================" -ForegroundColor Cyan

Write-Host "`nã€1. èƒŒæ™¯è‰²å®å®šä¹‰ã€‘esp32-c6-lcd-1.69.cc (çº¦86-94è¡Œ)" -ForegroundColor Green
Write-Host @"
#define BG_R_MIN  $([int]($rMinE / 8))    // $([int]$rMinE) >> 3
#define BG_R_MAX  $([int]($rMaxE / 8))    // $([int]$rMaxE) >> 3
#define BG_G_MIN  $([int]($gMinE / 4))   // $([int]$gMinE) >> 2
#define BG_G_MAX  $([int]($gMaxE / 4))   // $([int]$gMaxE) >> 2
#define BG_B_MIN  $([int]($bMinE / 8))   // $([int]$bMinE) >> 3
#define BG_B_MAX  $([int]($bMaxE / 8))   // $([int]$bMaxE) >> 3
"@

Write-Host "`nã€2. åŠ¨ç”»åŠ è½½å™¨å®ã€‘animation_loader.h" -ForegroundColor Green
Write-Host @"
#define ANIM_FRAME_WIDTH  $($json.width)
#define ANIM_FRAME_HEIGHT $($json.height)
#define ANIM_FRAME_COUNT  $($json.total_frames)
#define ANIM_TOTAL_FRAMES $($json.total_frames)
"@

Write-Host "`nã€3. åŠ¨ç”»æšä¸¾ã€‘animation_loader.h - AnimLoaderType" -ForegroundColor Green
$i = 0
$json.animations | ForEach-Object {
    $enumName = "ANIM_" + $_.name.ToUpper()
    Write-Host "    $enumName = $i,       // $($_.name)"
    $i++
}
Write-Host "    ANIM_TYPE_COUNT      // $i"

Write-Host "`nã€4. èƒŒæ™¯åŠ è½½å™¨åˆå§‹åŒ–ã€‘" -ForegroundColor Green
Write-Host "BackgroundLoader::GetInstance().Initialize(partition, $animSize, $($json.backgrounds.Count));"

Write-Host "`nã€5. èƒŒæ™¯æšä¸¾ã€‘background_manager.h - BackgroundIndex (å…±$($json.backgrounds.Count)ä¸ª)" -ForegroundColor Green
$json.backgrounds | ForEach-Object {
    $enumName = "BG_" + $_.name.ToUpper()
    Write-Host "    $enumName = $($_.frame),"
}
Write-Host "    BG_COUNT = $($json.backgrounds.Count)"

Write-Host "`n==================== Flash å¸ƒå±€ ====================" -ForegroundColor Cyan
Write-Host @"
åœ°å€          å†…å®¹                å¤§å°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0x800000      åŠ¨ç”»æ•°æ®            $($json.total_frames) Ã— $($json.frame_size) = $("{0:N0}" -f $animSize) å­—èŠ‚
0x$("{0:X}" -f (0x800000 + $bgOffset))      èƒŒæ™¯æ•°æ®            $($json.backgrounds.Count) Ã— $($json.bg_frame_size) = $("{0:N0}" -f $bgSize) å­—èŠ‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡                              $("{0:N0}" -f ($animSize + $bgSize)) å­—èŠ‚ ($("{0:N2}" -f (($animSize + $bgSize) / 1MB)) MB)
"@

Write-Host "`n==================== çƒ§å½•å‘½ä»¤ ====================" -ForegroundColor Cyan
Write-Host "copy /b gifs\frames.bin + gifs\backgrounds.bin gifs\assets_combined.bin"
Write-Host "python -m esptool --chip esp32c6 -p COMx --baud 921600 write_flash 0x800000 gifs\assets_combined.bin"
```

### æ­¥éª¤ 2: æ ¹æ®è„šæœ¬è¾“å‡ºæ›´æ–°ä»£ç 

è„šæœ¬ä¼šè‡ªåŠ¨å‘Šè¯‰ä½ éœ€è¦æ›´æ–°å“ªäº›æ–‡ä»¶çš„å“ªäº›éƒ¨åˆ†ã€‚

**å¿…é¡»æ›´æ–°çš„æ–‡ä»¶:**
| æ–‡ä»¶ | æ›´æ–°å†…å®¹ |
|------|----------|
| `esp32-c6-lcd-1.69.cc` | BG_R/G/B_MIN/MAX å® (é€æ˜èƒŒæ™¯æ£€æµ‹) |
| `animation_loader.h` | ANIM_FRAME_WIDTH/HEIGHT, ANIM_FRAME_COUNT, AnimLoaderType æšä¸¾ |
| `animation_loader.cc` | ANIMATION_TABLE æ•°ç»„ (åŠ¨ç”»å®šä¹‰) |
| `background_manager.h` | BackgroundIndex æšä¸¾ |
| `background_loader åˆå§‹åŒ–` | èƒŒæ™¯åç§»å’Œæ•°é‡å‚æ•° |

### æ­¥éª¤ 3: åˆå¹¶å¹¶çƒ§å½•èµ„æº

```cmd
:: åˆå¹¶èµ„æºæ–‡ä»¶
copy /b gifs\frames.bin + gifs\backgrounds.bin gifs\assets_combined.bin

:: çƒ§å½•èµ„æº (æ›¿æ¢ COMx ä¸ºå®é™…ç«¯å£)
python -m esptool --chip esp32c6 -p COMx --baud 921600 write_flash 0x800000 gifs\assets_combined.bin
```

æˆ–è€…ä½¿ç”¨ä¸€é”®è„šæœ¬:
```cmd
flash_assets.bat COMx
```

### æ­¥éª¤ 4: ç¼–è¯‘çƒ§å½•å›ºä»¶

```cmd
idf.py build
idf.py -p COMx flash monitor
```

---

## å¿«é€Ÿæ£€æŸ¥æ¸…å•

```
[ ] gifs/frames.bin      - åŠ¨ç”»æ–‡ä»¶ (è¿è¡Œåˆ†æè„šæœ¬ç¡®è®¤å¸§æ•°/å¤§å°)
[ ] gifs/backgrounds.bin - èƒŒæ™¯æ–‡ä»¶ (è¿è¡Œåˆ†æè„šæœ¬ç¡®è®¤æ•°é‡/å¤§å°)
[ ] gifs/index.json      - ç´¢å¼•æ–‡ä»¶ (è¿è¡Œåˆ†æè„šæœ¬)
[ ] æ›´æ–° BG_R/G/B_MIN/MAX å® (esp32-c6-lcd-1.69.cc)
[ ] æ›´æ–° ANIM_FRAME_* å® (animation_loader.h) - å¦‚å°ºå¯¸/å¸§æ•°å˜åŒ–
[ ] æ›´æ–° AnimLoaderType æšä¸¾ (animation_loader.h) - å¦‚åŠ¨ç”»ç§ç±»å˜åŒ–
[ ] æ›´æ–° ANIMATION_TABLE (animation_loader.cc) - å¦‚åŠ¨ç”»ç§ç±»å˜åŒ–
[ ] æ›´æ–° BackgroundIndex æšä¸¾ (background_manager.h) - å¦‚èƒŒæ™¯ç§ç±»å˜åŒ–
[ ] æ›´æ–° BackgroundLoader åˆå§‹åŒ–å‚æ•° - å¦‚å¸§æ•°/èƒŒæ™¯æ•°å˜åŒ–
[ ] åˆå¹¶: copy /b frames.bin + backgrounds.bin assets_combined.bin
[ ] çƒ§å½•: flash_assets.bat COMx æˆ– esptool write_flash
[ ] ç¼–è¯‘: idf.py build && idf.py -p COMx flash
```

---

## ä¸€ã€GIF åŠ¨ç”»èƒŒæ™¯ç³»ç»Ÿ

### 1.1 åŠŸèƒ½æ¦‚è¿°

å®ç°äº†åŸºäºè®¾å¤‡çŠ¶æ€çš„åŠ¨æ€èƒŒæ™¯åŠ¨ç”»ç³»ç»Ÿï¼š
- **å¾…æœºçŠ¶æ€ (Idle)** - æ’­æ”¾å‘¼å¸åŠ¨ç”» (STATIC2)
- **è†å¬çŠ¶æ€ (Listening)** - æ’­æ”¾è†å¬åŠ¨ç”» (DYNAMIC2)
- **è¯´è¯çŠ¶æ€ (Speaking)** - æ’­æ”¾è¯´è¯åŠ¨ç”» (DYNAMIC1)
- **è§¦æ‘¸äº¤äº’** - æ’­æ”¾è§¦æ‘¸åŠ¨ç”» (DYNAMIC4) + è§¦å‘å¯¹è¯

### 1.2 FS å¸§æ ¼å¼æ”¯æŒ (4-bit/8-bit åŒç‰ˆæœ¬)

æ”¯æŒä¸¤ç§ç´¢å¼•è‰²å¸§æ ¼å¼ï¼Œç”± `frames.bin` æ–‡ä»¶å¤´çš„ version å­—æ®µå†³å®šï¼š

| ç‰ˆæœ¬ | ç¼–ç æ–¹å¼ | æ¯å¸§å¤§å° | æœ€å¤§é¢œè‰²æ•° |
|------|----------|----------|------------|
| 0x0001 | 4-bit packed | widthÃ—height/2 å­—èŠ‚ | 16è‰² |
| 0x0002 | 8-bit indexed | widthÃ—height å­—èŠ‚ | 256è‰² |

**FS æ–‡ä»¶æ ¼å¼ (frames.bin)ï¼š**
```
Header (12 bytes fixed):
  magic[2]       : 'FS' (0x4653) æˆ– 'SF' (0x5346)
  version[2]     : 0x0001 (4-bit) æˆ– 0x0002 (8-bit)
  width[2]       : å›¾åƒå®½åº¦ (160)
  height[2]      : å›¾åƒé«˜åº¦ (128)
  colors[1]      : è°ƒè‰²æ¿é¢œè‰²æ•° (16-256)
  bg_color_idx[1]: èƒŒæ™¯è‰²ç´¢å¼•
  frame_count[2] : æ€»å¸§æ•°

Palette (colors Ã— 2 bytes):
  RGB565 æ ¼å¼ï¼Œå°ç«¯åº

Frame data:
  version 1: frame_count Ã— (widthÃ—height/2) å­—èŠ‚
  version 2: frame_count Ã— (widthÃ—height) å­—èŠ‚
```

**è§£ç é€»è¾‘ï¼š**
```cpp
if (version_ == 2) {
    // 8-bit: æ¯å­—èŠ‚1åƒç´ ï¼Œç›´æ¥ç´¢å¼•
    for (size_t i = 0; i < pixel_count; i++) {
        out_buf[i] = palette_[frame[i]];
    }
} else {
    // 4-bit: æ¯å­—èŠ‚2åƒç´ ï¼Œé«˜4ä½+ä½4ä½
    for (size_t i = 0; i < pixel_count; i += 2) {
        uint8_t byte = frame[i / 2];
        out_buf[i]     = palette_[(byte >> 4) & 0x0F];
        out_buf[i + 1] = palette_[byte & 0x0F];
    }
}
```

**Flash è®¿é—®æ–¹å¼ï¼š** ä½¿ç”¨ `esp_partition_read()` è¯»å–å¸§æ•°æ®ï¼Œé¿å… ESP32-C6 çš„ mmap åœ°å€ç©ºé—´é™åˆ¶ã€‚

### 1.3 åŠ¨ç”»æ˜¾ç¤ºå‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| å¸§å°ºå¯¸ | 160Ã—160 | åŸå§‹åƒç´ å¤§å° |
| æ˜¾ç¤ºå°ºå¯¸ | 280Ã—240 | å±å¹•åˆ†è¾¨ç‡ |
| æ˜¾ç¤ºåç§» | (60, 40) | å±…ä¸­æ˜¾ç¤º |
| ç¼©æ”¾æ¯”ä¾‹ | 256 (1.0x) | åŸå§‹åƒç´ ï¼Œä¸æ”¾å¤§ |
| å¸§é—´éš” | 167ms | çº¦ 6fps |

### 1.4 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FS ç´¢å¼•è‰²åŠ¨ç”»ç³»ç»Ÿæ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ AnimationLoader â”‚    â”‚   anim_mgr      â”‚                 â”‚
â”‚  â”‚(partition_read) â”‚â”€â”€â”€â”€â”‚ (åŠ¨ç”»ç®¡ç†å™¨)    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚                      â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ assetsåˆ†åŒº      â”‚    â”‚ å®šæ—¶å™¨å›è°ƒ      â”‚                 â”‚
â”‚  â”‚ (Flash 8MB)     â”‚    â”‚ (167ms/å¸§)      â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ— å¤´ RGB888 æ ¼å¼ï¼šç›´æ¥å­˜å‚¨åƒç´ æ•°æ®                           â”‚
â”‚  esp_partition_readï¼šé¿å… ESP32-C6 mmap åœ°å€ç©ºé—´é™åˆ¶         â”‚
â”‚  åŸå§‹åƒç´ æ˜¾ç¤ºï¼š160Ã—160 å±…ä¸­äº 280Ã—240 (æ— ç¼©æ”¾)               â”‚
â”‚  å­˜å‚¨ï¼š~2.5MB (95å¸§ Ã— 26KB/å¸§)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.5 æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `main/images/animation_loader.h` | ä¿®æ”¹ | FSæ ¼å¼åŠ è½½å™¨ï¼Œæ”¯æŒ4-bit/8-bit |
| `main/images/animation_loader.cc` | ä¿®æ”¹ | è§£ç å’Œå¸§è¯»å–å®ç° |
| `main/images/background_loader.h/cc` | æ–°å¢ | èƒŒæ™¯å›¾ç‰‡åŠ è½½å™¨ |
| `flash_assets.bat` | ä¿®æ”¹ | ç®€åŒ–ç‰ˆä¸€é”®çƒ§å½•è„šæœ¬ï¼ˆç›´æ¥çƒ§å½• frames.binï¼‰ |
| `main/boards/waveshare-c6-lcd-1.69/esp32-c6-lcd-1.69.cc` | ä¿®æ”¹ | åŠ¨ç”»+èƒŒæ™¯åˆæˆæ˜¾ç¤º |
| `partitions/v2/16m_c3.csv` | ä¿®æ”¹ | assetsåˆ†åŒº 4.5MB |
| `gifs/index.json` | æ–°å¢ | ç»Ÿä¸€ç´¢å¼•æ–‡ä»¶ |
| `gifs/ESP32_ä½¿ç”¨è¯´æ˜.txt` | æ–°å¢ | FSæ ¼å¼è¯´æ˜æ–‡æ¡£ |

### 1.6 æ ¸å¿ƒä»£ç æ”¹åŠ¨

#### 1.6.1 åŠ¨ç”»ç®¡ç†å™¨ç»“æ„ (`esp32-c6-lcd-1.69.cc`)

```cpp
static struct {
    lv_obj_t* bg_image;           // LVGLèƒŒæ™¯å›¾ç‰‡å¯¹è±¡
    esp_timer_handle_t timer;      // åŠ¨ç”»å®šæ—¶å™¨
    lv_img_dsc_t frame_dsc;        // å¸§æè¿°ç¬¦

    AnimationType current_type;    // å½“å‰åŠ¨ç”»ç±»å‹
    AnimationType base_type;       // åŸºç¡€åŠ¨ç”»(ç”±è®¾å¤‡çŠ¶æ€å†³å®š)
    int current_frame;             // å½“å‰å¸§ç´¢å¼•

    bool touch_active;             // è§¦æ‘¸åŠ¨ç”»æ’­æ”¾ä¸­
    int64_t touch_start_time;      // è§¦æ‘¸å¼€å§‹æ—¶é—´
    bool ui_transparent;           // UIæ˜¯å¦å·²é€æ˜åŒ–

    // UIå…ƒç´ æŒ‡é’ˆ(ç”¨äºå»¶è¿Ÿé€æ˜åŒ–)
    lv_obj_t* container;
    lv_obj_t* chat_message_label;
    // ...
} anim_mgr;
```

#### 1.6.2 FSæ ¼å¼åŠ è½½å™¨ (`animation_loader.cc`)

```cpp
// ä½¿ç”¨ esp_partition_read è¯»å–å¸§æ•°æ® (ESP32-C6 mmapç©ºé—´æœ‰é™)
bool AnimationLoader::Initialize() {
    // è¯»å–FSæ–‡ä»¶å¤´ (12 bytes)
    FSFileHeader header;
    esp_partition_read(partition_, 0, &header, sizeof(header));

    // éªŒè¯magic: 'FS' (0x4653) æˆ– 'SF' (0x5346)
    if (header.magic != 0x4653 && header.magic != 0x5346) {
        return false;
    }

    // è¯»å–è°ƒè‰²æ¿
    esp_partition_read(partition_, 12, palette_, colors_ * 2);
    return true;
}

// è§£ç å¸§åˆ°RGB565
void AnimationLoader::DecodeFrame(uint16_t frame_idx, uint16_t* out_buf) {
    if (version_ == 2) {
        // 8-bit: æ¯å­—èŠ‚1åƒç´ 
        for (size_t i = 0; i < pixel_count; i++) {
            out_buf[i] = palette_[frame[i]];
        }
    } else {
        // 4-bit: æ¯å­—èŠ‚2åƒç´ 
        for (size_t i = 0; i < pixel_count; i += 2) {
            uint8_t byte = frame[i / 2];
            out_buf[i]     = palette_[(byte >> 4) & 0x0F];
            out_buf[i + 1] = palette_[byte & 0x0F];
        }
    }
}
```

#### 1.4.3 å»¶è¿Ÿåˆå§‹åŒ–é€»è¾‘

```cpp
// åœ¨ animation_update_frame() ä¸­ï¼š
// ç­‰å¾…è®¾å¤‡è¿›å…¥ idle/listening/speaking çŠ¶æ€åæ‰åˆå§‹åŒ–åŠ¨ç”»
if (state != kDeviceStateIdle && state != kDeviceStateListening &&
    state != kDeviceStateSpeaking) {
    return;  // é…ç½‘æœŸé—´ä¸åŠ è½½åŠ¨ç”»ï¼Œä¿æŒåŸå§‹UI
}

// åŠ¨ç”»åŠ è½½æˆåŠŸåæ‰è®¾ç½®UIé€æ˜å’Œç™½è‰²æ–‡å­—
if (loader_initialized && !anim_mgr.ui_transparent) {
    apply_animation_ui_style();  // é€æ˜èƒŒæ™¯ + ç™½è‰²æ–‡å­—
}
```

### 1.7 åˆ†åŒºè¡¨é…ç½®

```csv
# partitions/v2/16m_c3.csv
assets,   data, spiffs,  0x800000,  4500K    # 4.5MB @ 8MB offset
```

### 1.8 è§¦æ‘¸äº¤äº’

```cpp
void animation_trigger_touch(bool is_center) {
    if (anim_mgr.touch_active) return;  // é˜²æ­¢é‡å¤è§¦å‘

    // æ’­æ”¾è§¦æ‘¸åŠ¨ç”»
    animation_switch_to(ANIM_TYPE_DYNAMIC4);
    anim_mgr.touch_active = true;

    // è§¦å‘å¯¹è¯ (å’ŒbootæŒ‰é’®ç›¸åŒ)
    Application::GetInstance().ToggleChatState();
}
```

---

## äºŒã€è®°å¿†ç³»ç»Ÿé›†æˆ

### 2.1 åŠŸèƒ½æ¦‚è¿°

é›†æˆäº†å®Œæ•´çš„AIè®°å¿†ç³»ç»Ÿï¼Œå®ç°ï¼š
- **ç”¨æˆ·æ¡£æ¡ˆ** - è®°ä½ç”¨æˆ·åå­—ã€ç”Ÿæ—¥ã€å¹´é¾„ã€æ€§åˆ«ã€ä½ç½®ç­‰åŸºæœ¬ä¿¡æ¯
- **å®¶åº­æˆå‘˜** - è®°å½•å®¶åº­å…³ç³»ç½‘ç»œï¼ˆæ”¯æŒå…±åŒå›å¿†ï¼‰
- **åå¥½è®¾ç½®** - è®°ä½ç”¨æˆ·å–œå¥½å’ŒåŒæ¶
- **äº‹ä»¶æ—¥å†** - è·Ÿè¸ªé‡è¦æ—¥æœŸå’Œè®¡åˆ’
- **èŠå¤©æ—¥å¿—** - ä¿å­˜å¯¹è¯å†å²
- **å¥½æ„Ÿåº¦ç³»ç»Ÿ** - æ ¹æ®äº’åŠ¨è¿›åŒ–äººæ ¼
- **ç‰¹å¾/ä¹ æƒ¯** - è®°å½•ç”¨æˆ·çš„æ€§æ ¼ç‰¹å¾å’Œç”Ÿæ´»ä¹ æƒ¯
- **ç›®æ ‡ç®¡ç†** - è·Ÿè¸ªç”¨æˆ·çš„ä¸ªäººç›®æ ‡
- **ç‰¹æ®Šæ—¶åˆ»** - ä¿å­˜é‡è¦çš„å¯¹è¯ç¬é—´

### 2.2 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è®°å¿†ç³»ç»Ÿæ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Application Layer                      â”‚   â”‚
â”‚  â”‚  OnConversationStart() â†’ AddMessage() â†’ CheckAndProcess()â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           â–¼                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚  â”‚ConversationManagerâ”‚  â”‚PersonalityEvolver â”‚            â”‚ â”‚
â”‚  â”‚  â”‚   (çŸ­æœŸè®°å¿†)       â”‚  â”‚   (å¥½æ„Ÿåº¦ç³»ç»Ÿ)    â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  - 20æ¡æ¶ˆæ¯ç¼“å­˜    â”‚  â”‚  - è¿ç»­å¤©æ•°      â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  - æ¯10è½®å¤„ç†      â”‚  â”‚  - æˆå°±ç³»ç»Ÿ      â”‚            â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â”‚            â”‚                      â”‚                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚  â”‚         MemoryExtractor (è‡ªåŠ¨æå–)         â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  "æˆ‘å«å°ç‹" â†’ name:å°ç‹ (confidence=5)    â”‚            â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â”‚                        â”‚                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚  â”‚                     â–¼                    â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â”‚PendingMemoryâ”‚  â”‚MemoryStorageâ”‚       â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ (å¾…ç¡®è®¤è®°å¿†) â”‚  â”‚ (é•¿æœŸè®°å¿†)  â”‚       â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ éœ€2æ¬¡æåŠ   â”‚â”€â†’â”‚  NVSå­˜å‚¨    â”‚       â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚            â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     MCP Server (å·¥å…·æ¥å£)                       â”‚
â”‚                              â”‚                                  â”‚
â”‚   memory(action='read')      â”‚   memory(action='write', ...)   â”‚
â”‚   memory(action='search')    â”‚   memory(action='delete', ...)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 è®°å¿†æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `main/memory/memory_types.h` | æ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰ |
| `main/memory/memory_storage.h/cc` | NVSå­˜å‚¨å¼•æ“ï¼ˆé•¿æœŸè®°å¿†ï¼‰ |
| `main/memory/memory_extractor.h/cc` | è‡ªåŠ¨è®°å¿†æå–ï¼ˆä¸­æ–‡æ¨¡å¼è¯†åˆ«ï¼‰ |
| `main/memory/pending_memory.h/cc` | å¾…ç¡®è®¤è®°å¿†ï¼ˆéœ€å¤šæ¬¡æåŠç¡®è®¤ï¼‰ |
| `main/memory/conversation_manager.h/cc` | å¯¹è¯ç®¡ç†å™¨ï¼ˆçŸ­æœŸè®°å¿†ï¼‰ |
| `main/memory/chat_logger.h/cc` | èŠå¤©å†å²æ—¥å¿— |
| `main/memory/personality_evolver.h/cc` | äººæ ¼è¿›åŒ–ç³»ç»Ÿ |
| `main/memory/memory_mcp_tools.h/cc` | MCPå·¥å…·æ³¨å†Œ |

### 2.4 å­˜å‚¨ç»“æ„

| æ•°æ®ç±»å‹ | æœ€å¤§æ•°é‡ | ä¼°ç®—ç©ºé—´ |
|----------|----------|----------|
| UserProfile | 1 | ~80B |
| FamilyMember | 8 | ~1KB |
| Preferences | 16é¡¹ | ~530B |
| Events | 16 | ~1.5KB |
| Facts | 20 | ~2.6KB |
| Traits | 10 | ~640B |
| Habits | 10 | ~640B |
| Moments | 10 | ~1.7KB |
| Goals | 5 | ~400B |
| PendingItems | 20 | ~2.2KB |
| ChatMessages | 30 | ~3KB |
| **æ€»è®¡** | | **~14KB** |

### 2.5 é•¿çŸ­è®°å¿†æœºåˆ¶

#### çŸ­æœŸè®°å¿†ï¼ˆConversationManagerï¼‰
- å­˜å‚¨æœ€è¿‘20æ¡æ¶ˆæ¯ï¼ˆ10è½®å¯¹è¯ï¼‰
- æ¯10è½®è‡ªåŠ¨è§¦å‘ `ProcessToLongTerm()`
- æå–æœ‰ä»·å€¼ä¿¡æ¯è½¬å…¥é•¿æœŸè®°å¿†

#### å¾…ç¡®è®¤è®°å¿†ï¼ˆPendingMemoryï¼‰
- ä½ç½®ä¿¡åº¦ä¿¡æ¯éœ€è¦å¤šæ¬¡æåŠï¼ˆé»˜è®¤2æ¬¡ï¼‰æ‰èƒ½ç¡®è®¤
- é«˜ç½®ä¿¡åº¦ï¼ˆâ‰¥5ï¼‰ç›´æ¥ä¿å­˜
- 7å¤©æœªç¡®è®¤è‡ªåŠ¨è¿‡æœŸæ¸…ç†

#### é•¿æœŸè®°å¿†ï¼ˆMemoryStorageï¼‰
- æ°¸ä¹…å­˜å‚¨åœ¨NVSä¸­
- æ”¯æŒå¢åˆ æ”¹æŸ¥

### 2.6 è‡ªåŠ¨è®°å¿†æå–

ç³»ç»Ÿè‡ªåŠ¨ä»ç”¨æˆ·å¯¹è¯ä¸­æå–ä¿¡æ¯ï¼ˆä¸­æ–‡æ¨¡å¼åŒ¹é…ï¼‰ï¼š

```
"æˆ‘å«å°ç‹"        â†’ name: å°ç‹ (confidence=5)
"æˆ‘ä»Šå¹´25å²"      â†’ age: 25 (confidence=5)
"æˆ‘ä½åœ¨åŒ—äº¬"      â†’ location: åŒ—äº¬ (confidence=4)
"æˆ‘çš„å¦ˆå¦ˆå«ç‹å¥³å£«" â†’ family: æ¯äº²:ç‹å¥³å£« (confidence=4)
"æˆ‘å–œæ¬¢åƒç«é”…"    â†’ like: ç«é”… (confidence=5)
"æˆ‘è®¨åŒåŠ ç­"      â†’ dislike: åŠ ç­ (confidence=5)
"æˆ‘æœ‰ä¸€åªçŒ«"      â†’ fact: æˆ‘æœ‰ä¸€åªçŒ« (confidence=3)
```

### 2.7 MCPå·¥å…·æ¥å£

ç»Ÿä¸€ä¸ºå•ä¸€ `memory` å·¥å…·ï¼Œé€šè¿‡ `action` å‚æ•°åŒºåˆ†æ“ä½œï¼š

| Action | åŠŸèƒ½ | å‚æ•° |
|--------|------|------|
| `read` | è·å–æ‰€æœ‰è®°å¿†æ•°æ® | æ—  |
| `write` | å†™å…¥æ–°è®°å¿† | type, content, force |
| `delete` | åˆ é™¤è®°å¿† | type, content |
| `search` | æœç´¢è®°å¿† | content (å…³é”®è¯) |

#### write æ”¯æŒçš„ç±»å‹

| Type | æ ¼å¼ | ç¤ºä¾‹ |
|------|------|------|
| name | ç›´æ¥å†…å®¹ | `content='å°æ˜'` |
| age | æ•°å­— | `content='25'` |
| birthday | MM-DD | `content='03-15'` |
| gender | male/female | `content='male'` |
| location | ç›´æ¥å†…å®¹ | `content='åŒ—äº¬'` |
| like | ç›´æ¥å†…å®¹ | `content='éŸ³ä¹'` |
| dislike | ç›´æ¥å†…å®¹ | `content='åŠ ç­'` |
| family | å…³ç³»:åå­— æˆ– å…³ç³»:åå­—:å…±åŒå›å¿† | `content='å¦ˆå¦ˆ:å¼ ä¸½:ä¸€èµ·å»è¿‡åŒ—äº¬'` |
| fact | ç›´æ¥å†…å®¹ | `content='æˆ‘æœ‰ä¸€åªçŒ«'` |
| trait | ç±»åˆ«:å†…å®¹ | `content='personality:å¼€æœ—'` |
| habit | å†…å®¹ æˆ– å†…å®¹:é¢‘ç‡ | `content='è·‘æ­¥:daily'` |
| event | æ—¥æœŸ:ç±»å‹:å†…å®¹ | `content='03-15:birthday:å¦ˆå¦ˆç”Ÿæ—¥'` |
| goal | å†…å®¹ æˆ– å†…å®¹:ä¼˜å…ˆçº§ | `content='å­¦è‹±è¯­:5'` |
| moment | ä¸»é¢˜:å†…å®¹ | `content='ç¬¬ä¸€æ¬¡èŠå¤©:ä»Šå¤©è®¤è¯†äº†æ–°æœ‹å‹'` |

#### force å‚æ•°

- `force=false`ï¼ˆé»˜è®¤ï¼‰ï¼šèµ°ç¡®è®¤æµç¨‹ï¼Œéœ€è¦æåŠ2æ¬¡æ‰æ°¸ä¹…ä¿å­˜
- `force=true`ï¼šè·³è¿‡ç¡®è®¤ï¼Œç«‹å³æ°¸ä¹…ä¿å­˜

**è§¦å‘è¯**ï¼ˆåº”ä½¿ç”¨ force=trueï¼‰ï¼šè®°ä½ã€åˆ«å¿˜äº†ã€è¯·è®°ä½ã€å¸®æˆ‘è®°ã€æˆ‘çš„åå­—å«

#### ç¤ºä¾‹

```python
# è¯»å–æ‰€æœ‰è®°å¿†
memory(action='read')

# æ™®é€šå†™å…¥ï¼ˆéœ€ç¡®è®¤ï¼‰
memory(action='write', type='name', content='å°æ˜')
# è¿”å›: "pending: å°æ˜ (needs more mentions to confirm)"

# å¼ºåˆ¶å†™å…¥ï¼ˆç«‹å³ä¿å­˜ï¼‰
memory(action='write', type='name', content='å°æ˜', force=true)
# è¿”å›: "added: å°æ˜"

# æœç´¢
memory(action='search', content='å¦ˆå¦ˆ')

# åˆ é™¤
memory(action='delete', type='like', content='éŸ³ä¹')
```

### 2.8 åº”ç”¨å±‚é›†æˆ

åœ¨ `application.cc` ä¸­é›†æˆè®°å¿†ç³»ç»Ÿï¼š

```cpp
// å¤´æ–‡ä»¶
#include "conversation_manager.h"
#include "personality_evolver.h"

// åˆå§‹åŒ–ï¼ˆRegisterMcpTools ä¸­ï¼‰
ConversationManager::GetInstance().Init();
PersonalityEvolver::GetInstance().Init();

// è¿›å…¥ Listening çŠ¶æ€æ—¶
PersonalityEvolver::GetInstance().OnConversationStart();

// æ”¶åˆ°ç”¨æˆ·æ¶ˆæ¯ (stt) æ—¶
ConversationManager::GetInstance().AddMessage("user", message.c_str());
PersonalityEvolver::GetInstance().AddMessageCount(1);

// æ”¶åˆ°AIå›å¤ (tts/sentence_start) æ—¶
ConversationManager::GetInstance().AddMessage("assistant", message.c_str());
PersonalityEvolver::GetInstance().AddMessageCount(1);

// TTS ç»“æŸæ—¶
ConversationManager::GetInstance().CheckAndProcess();
```

---

## ä¸‰ã€WiFi é¢„é…ç½®

åˆ›å»º `wifi/wifi.txt` æ–‡ä»¶ï¼ˆç¬¬ä¸€è¡ŒSSIDï¼Œç¬¬äºŒè¡Œå¯†ç ï¼‰ï¼š

```
ä½ çš„WiFiåç§°
ä½ çš„WiFiå¯†ç 
```

è¿è¡Œ `flash_all.bat` æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ `wifi_config.bin` å¹¶çƒ§å½•åˆ° `0x7F0000`ã€‚

---

## å››ã€è§¦æ‘¸äº¤äº’ä¼˜åŒ–

### 4.1 å•æ¬¡ç‚¹å‡»è§¦å‘

å°†åŒå‡»è§¦å‘æ”¹ä¸ºå•æ¬¡ç‚¹å‡»ï¼Œæé«˜å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒï¼š

```cpp
// è§¦æ‘¸æ£€æµ‹é˜ˆå€¼
static constexpr int16_t TAP_MAX_DISTANCE = 50;       // ç‚¹å‡»æœ€å¤§ç§»åŠ¨è·ç¦» (åƒç´ )
static constexpr int16_t SWIPE_MIN_DISTANCE = 60;     // æ»‘åŠ¨æœ€å°è·ç¦» (åƒç´ )
static constexpr int64_t TAP_MAX_DURATION_MS = 600;   // ç‚¹å‡»æœ€å¤§æ—¶é•¿ (æ¯«ç§’)
```

**äº¤äº’æ–¹å¼ï¼š**
- **å•æ¬¡ç‚¹å‡»** (ç§»åŠ¨ â‰¤50px, æ—¶é•¿ â‰¤600ms) â†’ åˆ‡æ¢å¯¹è¯çŠ¶æ€
- **æ»‘åŠ¨** (ç§»åŠ¨ â‰¥60px) â†’ æ’­æ”¾ pet_head æ‘¸å¤´åŠ¨ç”»

### 4.2 éšæœºæ¼«æ­¥åŠ¨ç”»

å®ç°äº†æ›´è‡ªç„¶çš„åŠ¨ç”»æ’­æ”¾æ¨¡å¼ï¼Œå–ä»£å›ºå®šçš„ 0â†’7â†’0 å¼¹è·³å¾ªç¯ï¼š

```cpp
// éšæœºæ¼«æ­¥ï¼š85% ç»§ç»­å½“å‰æ–¹å‘ï¼Œ15% åè½¬
uint32_t rand_val = esp_random() % 100;

if (anim_mgr.current_frame <= 0) {
    anim_mgr.anim_direction = 1;   // è¾¹ç•Œï¼šå¼ºåˆ¶å‰è¿›
} else if (anim_mgr.current_frame >= max_frame_index) {
    anim_mgr.anim_direction = -1;  // è¾¹ç•Œï¼šå¼ºåˆ¶åé€€
} else {
    // ä¸­é—´å¸§ï¼š85% ç»§ç»­ï¼Œ15% åè½¬
    if (rand_val >= 85) {
        anim_mgr.anim_direction = -anim_mgr.anim_direction;
    }
}
```

**æ•ˆæœï¼š**
- åŠ¨ç”»æ›´æœ‰æœºã€è‡ªç„¶ï¼Œé¿å…æœºæ¢°çš„æ¥å›å¾ªç¯
- å¶å°”ä¼šåœ¨æŸäº›å¸§"å¾˜å¾Š"ï¼Œäº§ç”Ÿå‘¼å¸æ„Ÿ
- è¾¹ç•Œå¤„ç†ç¡®ä¿ä¸ä¼šè¶Šç•Œ

### 4.3 æ»‘åŠ¨æ‘¸å¤´æ‰‹åŠ¿

æ»‘åŠ¨å±å¹•è§¦å‘ **pet_head æ‘¸å¤´åŠ¨ç”»**ï¼ŒæŒç»­æ»‘åŠ¨å¯ä¿æŒåŠ¨ç”»æ’­æ”¾ï¼š

```cpp
// æ»‘åŠ¨å¼€å§‹ â†’ æ’­æ”¾ pet_head æ‘¸å¤´åŠ¨ç”»
void animation_start_swipe() {
    anim_mgr.swipe_active = true;
    animation_switch_to("pet_head");
}

// æŒç»­æ»‘åŠ¨ â†’ ä¿æŒåŠ¨ç”»æ´»è·ƒ
void animation_continue_swipe() {
    if (anim_mgr.swipe_active) {
        anim_mgr.touch_start_time = esp_timer_get_time() / 1000;
        anim_mgr.last_activity_time = anim_mgr.touch_start_time;
    }
}

// æ»‘åŠ¨ç»“æŸ â†’ ç­‰å¾…åŠ¨ç”»å½’é›¶
void animation_end_swipe() {
    anim_mgr.swipe_ending = true;
}
```

**æ•ˆæœï¼š**
- åœ¨å±å¹•ä¸Šæ»‘åŠ¨ â‰¥60 åƒç´ å³è§¦å‘æ‘¸å¤´åŠ¨ç”»
- æŒç»­æ»‘åŠ¨ä¼šä¿æŒåŠ¨ç”»æ’­æ”¾
- æ¾å¼€ååŠ¨ç”»æ’­æ”¾å®Œå½“å‰å¸§å½’é›¶

### 4.4 é•¿æŒ‰ Boot é”®

é•¿æŒ‰ Boot é”®ï¼ˆ1ç§’ï¼‰è§¦å‘ dynamic3 åŠ¨ç”»ï¼Œæ•ˆæœä¸æ»‘åŠ¨å±å¹•ä¸€è‡´ï¼š

```cpp
// åˆå§‹åŒ–æ—¶è®¾ç½®é•¿æŒ‰æ—¶é—´ä¸º 1000ms
boot_button_(BOOT_BUTTON_GPIO, false, 1000)

// é•¿æŒ‰å¼€å§‹ â†’ æ’­æ”¾ dynamic3
boot_button_.OnLongPress([this]() {
    anim_mgr.long_press_holding = true;
    animation_start_swipe();
});

// æ¾å¼€æŒ‰é”® â†’ åŠ¨ç”»å½’é›¶
boot_button_.OnPressUp([this]() {
    if (anim_mgr.long_press_holding) {
        anim_mgr.long_press_holding = false;
        animation_end_swipe();
    }
});
```

**äº¤äº’æ–¹å¼æ€»ç»“ï¼š**
| æ“ä½œ | æ•ˆæœ |
|------|------|
| å•å‡» Boot | åˆ‡æ¢å¯¹è¯çŠ¶æ€ |
| é•¿æŒ‰ Boot (1ç§’) | æ’­æ”¾ walk è¡Œèµ°åŠ¨ç”» |
| ç‚¹å‡»å±å¹• | åˆ‡æ¢å¯¹è¯çŠ¶æ€ |
| æ»‘åŠ¨å±å¹• | æ’­æ”¾ pet_head æ‘¸å¤´åŠ¨ç”» |

### 4.5 PWR é”®åŠŸèƒ½

PWR é”®ï¼ˆç”µæºé”®ï¼‰æ”¯æŒå¤šç§æ“ä½œï¼š

| æ“ä½œ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| å•å‡» | åˆ‡æ¢è†å¬çŠ¶æ€ | ä¸ BOOT é”®ç›¸åŒ |
| åŒå‡» | åˆ‡æ¢äº®åº¦ | ä¿ç•™åŸåŠŸèƒ½ |
| é•¿æŒ‰ 1 ç§’ | æ’­æ”¾ walk è¡Œèµ°åŠ¨ç”» | å® ç‰©èµ°å‡ºå±å¹• |
| é•¿æŒ‰ 3 ç§’ | å¼€å§‹å…³æœºå€’è®¡æ—¶ | å±å¹•æ˜¾ç¤º"å…³æœº: 3s/2s/1s" |
| é•¿æŒ‰ 6 ç§’ | æ‰§è¡Œå…³æœº | å€’è®¡æ—¶ç»“æŸåè¿›å…¥æ·±åº¦ç¡çœ  |
| ä¸‰å‡» | é‡ç½® WiFi | è¿›å…¥ WiFi é…ç½®æ¨¡å¼ |

**å…³æœºæµç¨‹ï¼š**
1. é•¿æŒ‰ PWR é”®è¾¾åˆ° 3 ç§’æ—¶ï¼Œå±å¹•å¼€å§‹æ˜¾ç¤ºå€’è®¡æ—¶"å…³æœº: 3s"
2. ç»§ç»­é•¿æŒ‰ï¼Œå€’è®¡æ—¶é€’å‡åˆ°"å…³æœº: 2s"ã€"å…³æœº: 1s"
3. é•¿æŒ‰è¾¾åˆ° 6 ç§’æ—¶ï¼Œæ‰§è¡Œå…³æœºæ“ä½œ
4. å…³æœºæ—¶ä¼šè°ƒç”¨ `PowerOff()` å¹¶è¿›å…¥ ESP32 æ·±åº¦ç¡çœ æ¨¡å¼

**æ³¨æ„ï¼š** åœ¨é™é»˜æ¨¡å¼ä¸‹ï¼ŒPWR é•¿æŒ‰ 1 ç§’ç”¨äºé€€å‡ºé™é»˜æ¨¡å¼ï¼ˆå‚è§ç¬¬ä¹èŠ‚ï¼‰

### 4.6 å® ç‰©éšæœºèµ°åŠ¨

å® ç‰©åœ¨ç©ºé—²çŠ¶æ€ä¸‹ä¼š**è‡ªåŠ¨éšæœºèµ°åŠ¨**ï¼Œè®©å® ç‰©æ›´åŠ ç”ŸåŠ¨æ´»æ³¼ï¼š

```cpp
// éšæœºèµ°åŠ¨é…ç½®
#define RANDOM_WALK_MIN_INTERVAL_MS  (5 * 1000)   // æœ€çŸ­5ç§’
#define RANDOM_WALK_MAX_INTERVAL_MS  (10 * 1000)  // æœ€é•¿10ç§’
#define RANDOM_WALK_DURATION_MS      2000         // èµ°åŠ¨æŒç»­2ç§’
#define RANDOM_WALK_MAX_OFFSET_X     60           // Xè½´èŒƒå›´Â±60åƒç´ ï¼ˆè§¦åŠè¾¹ç•Œï¼‰
#define RANDOM_WALK_MAX_OFFSET_Y     15           // Yè½´èŒƒå›´Â±15åƒç´ ï¼ˆä¸è¶…å‡ºUIï¼‰
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- æ¯ **5-10ç§’** éšæœºè§¦å‘ä¸€æ¬¡èµ°åŠ¨
- **Xè½´èŒƒå›´**ï¼šÂ±60åƒç´ ï¼Œå¯è§¦åŠå±å¹•å·¦å³è¾¹ç•Œ
- **Yè½´èŒƒå›´**ï¼šÂ±15åƒç´ ï¼Œä¿æŒåœ¨ top bar å’Œ bottom bar ä¹‹é—´
- èµ°åŠ¨æ—¶æ’­æ”¾ **walk åŠ¨ç”»**ï¼Œå¹¶æ ¹æ®ç§»åŠ¨æ–¹å‘è‡ªåŠ¨é•œåƒ
- ä½¿ç”¨ **ease-in-out æ›²çº¿** è®©ç§»åŠ¨æ›´åŠ å¹³æ»‘è‡ªç„¶

**ä¸ä¼šè§¦å‘èµ°åŠ¨çš„æƒ…å†µï¼š**
- è¯­éŸ³äº¤äº’ä¸­ï¼ˆè†å¬/è¯´è¯çŠ¶æ€ï¼‰
- è§¦æ‘¸/æ»‘åŠ¨æ“ä½œä¸­
- ç¡çœ çŠ¶æ€
- æ­£åœ¨æ‰§è¡Œå…¶ä»–èµ°åŠ¨åŠ¨ç”»ï¼ˆå¦‚èµ°å‡ºå±å¹•ï¼‰
- **PWR æŒ‰é”®æ“ä½œå‰å 1 ç§’å†…**ï¼ˆé˜²æ­¢ä¸ PWR èµ°åŠ¨å†²çªï¼‰

**PWR èµ°åŠ¨ä¿æŠ¤æœºåˆ¶ï¼š**
- æŒ‰ä¸‹ PWR é”®æ—¶ç«‹å³ä¸­æ­¢æ­£åœ¨è¿›è¡Œçš„éšæœºèµ°åŠ¨/åŠ¨ä½œ
- PWR èµ°åŠ¨ï¼ˆèµ°å‡º/èµ°å›ï¼‰å®Œæˆåæœ‰ 1 ç§’å†·å´æœŸ
- å†·å´æœŸå†…ä¸ä¼šè§¦å‘æ–°çš„éšæœºèµ°åŠ¨æˆ–éšæœºåŠ¨ä½œ

**æ ¸å¿ƒå‡½æ•°ï¼š**
- `start_random_walk()` - ç”Ÿæˆéšæœºç›®æ ‡ä½ç½®ï¼Œå¼€å§‹walkåŠ¨ç”»
- `update_random_walk()` - å¹³æ»‘æ›´æ–°å® ç‰©ä½ç½®
- `check_random_walk()` - æ£€æŸ¥æ˜¯å¦åº”è¯¥å¼€å§‹æ–°çš„èµ°åŠ¨

**çŠ¶æ€åˆ‡æ¢ä¿æŠ¤ï¼š**
- å½“ `SetStatus(STANDBY)` æˆ– `SetEmotion("idle")` è¢«è°ƒç”¨æ—¶ï¼Œå¦‚æœéšæœºèµ°åŠ¨æ­£åœ¨è¿›è¡Œï¼Œä¸ä¼šåˆ‡æ¢åŠ¨ç”»
- å½“åˆ‡æ¢åˆ°è†å¬/è¯´è¯çŠ¶æ€æ—¶ï¼Œä¼šæ­£ç¡®ä¸­æ­¢éšæœºèµ°åŠ¨å¹¶é‡ç½®é•œåƒçŠ¶æ€
- è¿™é˜²æ­¢äº†"å® ç‰©åå§¿ç§»åŠ¨"çš„bugï¼ˆåŠ¨ç”»è¢«ä¸­æ–­ä½†ä½ç½®ä»åœ¨æ›´æ–°ï¼‰

### 4.7 å¾…æœºè‡ªåŠ¨ç¡è§‰

è®¾å¤‡åœ¨å¾…æœºçŠ¶æ€ä¸‹æ— äº¤äº’ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° **sleep ç¡è§‰åŠ¨ç”»**ã€‚ç¡çœ è¶…æ—¶æ—¶é—´æ ¹æ®æ—¶é—´æ®µè‡ªåŠ¨è°ƒæ•´ï¼š

| æ—¶é—´æ®µ | è¶…æ—¶æ—¶é—´ | è¯´æ˜ |
|--------|----------|------|
| ç™½å¤© (8:00-18:59) | 15 åˆ†é’Ÿ | æ—¥é—´æ´»åŠ¨æ—¶é—´è¾ƒé•¿ |
| å¤œæ™š (19:00-7:59) | 5 åˆ†é’Ÿ | å¤œé—´å¿«é€Ÿè¿›å…¥çœç”µæ¨¡å¼ |

```cpp
#define ANIM_SLEEP_TIMEOUT_DAY_MS   (15 * 60 * 1000)  // ç™½å¤©15åˆ†é’Ÿ
#define ANIM_SLEEP_TIMEOUT_NIGHT_MS (5 * 60 * 1000)   // å¤œæ™š5åˆ†é’Ÿ

// æ ¹æ®å½“å‰å°æ—¶åˆ¤æ–­ä½¿ç”¨å“ªä¸ªè¶…æ—¶å€¼
int hour = timeinfo.tm_hour;
int64_t sleep_timeout = (hour >= 8 && hour < 19)
    ? ANIM_SLEEP_TIMEOUT_DAY_MS
    : ANIM_SLEEP_TIMEOUT_NIGHT_MS;
```

**å”¤é†’æ–¹å¼ï¼š**
- è§¦æ‘¸å±å¹•ï¼ˆç‚¹å‡»æˆ–æ»‘åŠ¨ï¼‰
- æŒ‰ä¸‹ä»»æ„æŒ‰é”®ï¼ˆBoot/PWRï¼‰
- è®¾å¤‡çŠ¶æ€å˜åŒ–ï¼ˆè¿›å…¥è†å¬/è¯´è¯ï¼‰

**æ³¨æ„ï¼š**
- ä»…åœ¨ **å¾…æœºçŠ¶æ€ (kDeviceStateIdle)** ä¸‹ç”Ÿæ•ˆ
- è†å¬/è¯´è¯çŠ¶æ€ä¸ä¼šè§¦å‘ç¡çœ 
- ä»»ä½•äº¤äº’éƒ½ä¼šé‡ç½®è®¡æ—¶å™¨
- éšæœºèµ°åŠ¨**ä¸ä¼š**é‡ç½®è®¡æ—¶å™¨ï¼ˆå® ç‰©å¯ä»¥è¾¹èµ°è¾¹ç­‰ç¡è§‰ï¼‰

### 4.8 å® ç‰©éšæœºåŠ¨ä½œ

å® ç‰©åœ¨ç©ºé—²çŠ¶æ€ä¸‹é™¤äº†éšæœºèµ°åŠ¨ï¼Œè¿˜ä¼š**éšæœºè§¦å‘å„ç§åŠ¨ä½œ**ï¼Œè®©å® ç‰©æ›´åŠ ç”ŸåŠ¨æœ‰è¶£ï¼š

```cpp
// éšæœºåŠ¨ä½œé…ç½®
#define RANDOM_ACTION_MIN_INTERVAL_MS  (5 * 1000)    // æœ€çŸ­5ç§’
#define RANDOM_ACTION_MAX_INTERVAL_MS  (10 * 1000)   // æœ€é•¿10ç§’
#define RANDOM_ACTION_DURATION_MS      3000          // åŠ¨ä½œæŒç»­3ç§’

// å¯ç”¨åŠ¨ä½œåˆ—è¡¨
static const char* RANDOM_ACTIONS[] = {"pet_head", "talk", "listen"};
```

**å¯ç”¨åŠ¨ä½œï¼š**
| åŠ¨ä½œ | è¯´æ˜ |
|------|------|
| pet_head | æ‘¸å¤´åŠ¨ä½œï¼ˆå’Œæ»‘åŠ¨è§¦å‘ç›¸åŒï¼‰ |
| talk | è¯´è¯åŠ¨ä½œ |
| listen | è†å¬åŠ¨ä½œ |

**è§¦å‘æ¡ä»¶ï¼ˆä¸éšæœºèµ°åŠ¨ç›¸åŒï¼‰ï¼š**
- è®¾å¤‡å¤„äºå¾…æœºçŠ¶æ€ (kDeviceStateIdle)
- éç¡çœ çŠ¶æ€
- éè§¦æ‘¸/æ»‘åŠ¨æ“ä½œä¸­
- éè¯­éŸ³äº¤äº’ä¸­
- **éšæœºèµ°åŠ¨æœªè¿›è¡Œä¸­**ï¼ˆäº’æ–¥ï¼‰

**æ ¸å¿ƒå‡½æ•°ï¼š**
- `start_random_action()` - ä»åŠ¨ä½œåˆ—è¡¨éšæœºé€‰æ‹©ä¸€ä¸ªåŠ¨ä½œæ’­æ”¾
- `update_random_action()` - æ£€æŸ¥åŠ¨ä½œæ˜¯å¦å®Œæˆ
- `check_random_action()` - æ£€æŸ¥æ˜¯å¦åº”è¯¥å¼€å§‹æ–°çš„åŠ¨ä½œ

**äº’æ–¥æœºåˆ¶ï¼š**
- éšæœºåŠ¨ä½œå’Œéšæœºèµ°åŠ¨**äº’æ–¥**ï¼Œä¸ä¼šåŒæ—¶è§¦å‘
- å¦‚æœæ­£åœ¨èµ°åŠ¨ï¼Œä¸ä¼šè§¦å‘éšæœºåŠ¨ä½œ
- å¦‚æœæ­£åœ¨æ’­æ”¾åŠ¨ä½œï¼Œä¸ä¼šè§¦å‘éšæœºèµ°åŠ¨
- éšæœºåŠ¨ä½œ**ä¸ä¼š**é‡ç½®å¾…æœºç¡çœ è®¡æ—¶å™¨

---

## äº”ã€å…¶ä»–æ”¹åŠ¨

### 5.1 å­—ä½“å‡çº§

```cmake
# main/CMakeLists.txt
# ä» font_puhui_basic_20_4 (çº¦500å­—) å‡çº§åˆ° font_puhui_20_4 (7415å­—)
set(BUILTIN_TEXT_FONT font_puhui_20_4)
```

### 5.2 è§¦æ‘¸å†·å´æœºåˆ¶

```cpp
// è§¦æ‘¸I2Cé”™è¯¯æ—¶è¿›å…¥å†·å´æœŸï¼Œé¿å…æ—¥å¿—åˆ·å±
static constexpr int TOUCH_MAX_ERRORS = 10;
static constexpr int64_t TOUCH_COOLDOWN_MS = 5000;

if (touch_state.error_count >= TOUCH_MAX_ERRORS) {
    touch_state.in_cooldown = true;
    // 5ç§’åé‡è¯•
}
```

### 5.3 Protocolæ‰©å±•

```cpp
// main/protocols/protocol.h - æ–°å¢æ–¹æ³•
virtual void SendTouchMessage(const std::string& message);

// main/application.h - æ–°å¢æ–¹æ³•
void SendTouchMessage(const std::string& message);
std::string pending_touch_message_;  // å¾…å‘é€çš„è§¦æ‘¸æ¶ˆæ¯
```

---

## å…­ã€ç¼–è¯‘å’Œçƒ§å½•

å‚è§"å¿«é€Ÿå¼€å§‹"ç« èŠ‚ï¼Œæ¨èä½¿ç”¨ `flash_all.bat COM10` ä¸€é”®å®Œæˆæ‰€æœ‰æ­¥éª¤ã€‚

---

## ä¸ƒã€å®šæ—¶æé†’åŠŸèƒ½

### 7.1 åŠŸèƒ½æ¦‚è¿°

æ–°å¢å®šæ—¶æé†’ï¼ˆé—¹é’Ÿï¼‰åŠŸèƒ½ï¼Œæ”¯æŒé€šè¿‡è¯­éŸ³è®¾ç½®æé†’ï¼Œåˆ°æ—¶é—´åè®¾å¤‡ä¼šå“é“ƒå¹¶æ˜¾ç¤ºæé†’å†…å®¹ã€‚

### 7.2 ä½¿ç”¨æ–¹å¼

ç”¨æˆ·å¯ä»¥é€šè¿‡è¯­éŸ³ä¸ AI å¯¹è¯æ¥è®¾ç½®æé†’ï¼š

```
"å¸®æˆ‘è®¾ä¸ªé—¹é’Ÿ5åˆ†é’Ÿåæé†’æˆ‘å–æ°´"
"æ¯å¤©æ—©ä¸Š8ç‚¹æé†’æˆ‘åƒè¯"
"ä¸‹åˆ3ç‚¹æé†’æˆ‘å¼€ä¼š"
"å–æ¶ˆå–æ°´çš„æé†’"
"æˆ‘æœ‰å“ªäº›æé†’"
```

### 7.3 æé†’è§¦å‘è¡Œä¸º

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| å“é“ƒéŸ³é‡ | æœ€å¤§éŸ³é‡ï¼ˆ100%ï¼‰ï¼Œåœæ­¢åæ¢å¤åŸéŸ³é‡ |
| å“é“ƒé¢‘ç‡ | çº¦æ¯1.3ç§’å¾ªç¯æ’­æ”¾ä¸€æ¬¡ |
| å­—å¹•æ˜¾ç¤º | å±å¹•æ˜¾ç¤º"æé†’"çŠ¶æ€å’Œæé†’å†…å®¹ |
| åœæ­¢æ–¹å¼ | æŒ‰ **Boot æŒ‰é’®** æˆ– è¯´ **å”¤é†’è¯** |

### 7.4 æé†’ç±»å‹

| ç±»å‹ | repeat å‚æ•° | è§¦å‘åè¡Œä¸º |
|------|-------------|------------|
| ä¸€æ¬¡æ€§ | `none` | **è‡ªåŠ¨åˆ é™¤** |
| æ¯å¤© | `daily` | ä¿ç•™ï¼Œè®¡ç®—æ˜å¤©åŒä¸€æ—¶é—´ |
| æ¯å‘¨ | `weekly` | ä¿ç•™ï¼Œè®¡ç®—ä¸‹å‘¨åŒä¸€æ—¶é—´ |
| æ¯æœˆ | `monthly` | ä¿ç•™ï¼Œè®¡ç®—ä¸‹æœˆåŒä¸€æ—¶é—´ |

### 7.5 æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `main/memory/schedule_manager.h` | æ–°å¢ | å®šæ—¶ä»»åŠ¡ç®¡ç†å™¨å¤´æ–‡ä»¶ |
| `main/memory/schedule_manager.cc` | æ–°å¢ | å®šæ—¶ä»»åŠ¡ç®¡ç†å™¨å®ç°ï¼ˆNVSæŒä¹…åŒ–ï¼‰ |
| `main/memory/memory_mcp_tools.cc` | ä¿®æ”¹ | æ³¨å†Œ schedule MCP å·¥å…· |
| `main/memory/personality_evolver.cc` | ä¿®æ”¹ | ç³»ç»Ÿæç¤ºè¯å¢åŠ å·¥å…·è¯´æ˜ |
| `main/application.h` | ä¿®æ”¹ | æ·»åŠ æé†’ç›¸å…³æˆå‘˜å˜é‡ |
| `main/application.cc` | ä¿®æ”¹ | æé†’å›è°ƒå’Œåœæ­¢é€»è¾‘ |
| `main/CMakeLists.txt` | ä¿®æ”¹ | æ·»åŠ  schedule_manager.cc |

### 7.6 MCP å·¥å…·æ¥å£

AI å¯ä»¥è°ƒç”¨çš„ `schedule` å·¥å…·ï¼š

```json
{
  "name": "schedule",
  "parameters": {
    "action": "add | remove | list",
    "time": "HH:MM æˆ– YYYY-MM-DD HH:MM",
    "content": "æé†’å†…å®¹",
    "repeat": "none | daily | weekly | monthly",
    "id": "æé†’IDï¼ˆåˆ é™¤æ—¶ä½¿ç”¨ï¼‰"
  }
}
```

**ç¤ºä¾‹è°ƒç”¨ï¼š**
```json
// æ·»åŠ ä¸€æ¬¡æ€§æé†’
{"action": "add", "time": "14:30", "content": "å¼€ä¼š", "repeat": "none"}

// æ·»åŠ æ¯æ—¥é‡å¤æé†’
{"action": "add", "time": "08:00", "content": "åƒè¯", "repeat": "daily"}

// åˆ é™¤æé†’
{"action": "remove", "id": "12345"}

// åˆ—å‡ºæ‰€æœ‰æé†’
{"action": "list"}
```

### 7.7 æ ¸å¿ƒä»£ç å®ç°

#### 7.7.1 ScheduleManager æ ¸å¿ƒæ–¹æ³•

```cpp
// å•ä¾‹è·å–
ScheduleManager::GetInstance().Init();

// æ·»åŠ æé†’ - è¿”å›æé†’ID
uint32_t id = ScheduleManager::GetInstance().AddSchedule("14:30", "å¼€ä¼š", "none");

// åˆ é™¤æé†’
ScheduleManager::GetInstance().RemoveSchedule(id);

// è®¾ç½®æé†’å›è°ƒ
ScheduleManager::GetInstance().SetReminderCallback([](const ScheduleItem& item) {
    // è§¦å‘æ—¶æ‰§è¡Œ
});

// æ£€æŸ¥å¹¶è§¦å‘ï¼ˆæ¯åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡ï¼‰
ScheduleManager::GetInstance().CheckAndTrigger();
```

#### 7.7.2 æé†’å›è°ƒå®ç° (`application.cc`)

```cpp
ScheduleManager::GetInstance().SetReminderCallback([this](const ScheduleItem& item) {
    Schedule([this, content = std::string(item.content)]() {
        // 1. ä¸­æ–­å½“å‰å¯¹è¯ï¼ˆå¦‚æœæœ‰ï¼‰
        if (GetDeviceState() == kDeviceStateSpeaking) {
            AbortSpeaking(kAbortReasonNone);
        } else if (GetDeviceState() == kDeviceStateListening) {
            protocol_->CloseAudioChannel();
        }

        // 2. å¯åŠ¨æé†’å¾ªç¯ä»»åŠ¡
        reminder_playing_ = true;
        reminder_content_ = content;

        xTaskCreate([](void* arg) {
            Application* app = static_cast<Application*>(arg);
            auto codec = Board::GetInstance().GetAudioCodec();

            // ä¿å­˜åŸéŸ³é‡ï¼Œè®¾ç½®æœ€å¤§éŸ³é‡
            int original_volume = codec->output_volume();
            codec->SetOutputVolume(100);

            while (app->reminder_playing_) {
                // åˆ·æ–°æ˜¾ç¤º
                auto display = Board::GetInstance().GetDisplay();
                display->SetStatus("æé†’");
                display->SetEmotion("bell");
                display->SetChatMessage("system", app->reminder_content_.c_str());

                // æ’­æ”¾æé†’éŸ³
                app->GetAudioService().PlaySound(Lang::Sounds::OGG_SUCCESS);

                // ç­‰å¾…çº¦1.3ç§’
                for (int i = 0; i < 13 && app->reminder_playing_; i++) {
                    vTaskDelay(pdMS_TO_TICKS(100));
                }
            }

            // æ¢å¤åŸéŸ³é‡
            codec->SetOutputVolume(original_volume);
            vTaskDelete(NULL);
        }, "reminder", 2048, this, 1, nullptr);
    });
});
```

#### 7.7.3 åœæ­¢æé†’ (`HandleToggleChatEvent`)

```cpp
void Application::HandleToggleChatEvent() {
    // Boot æŒ‰é’®åœæ­¢æé†’
    if (reminder_playing_) {
        ESP_LOGI(TAG, "Stopping reminder alarm");
        reminder_playing_ = false;
        reminder_content_.clear();

        auto display = Board::GetInstance().GetDisplay();
        display->SetStatus(Lang::Strings::STANDBY);
        display->SetEmotion("neutral");
        display->SetChatMessage("system", "");
        return;
    }
    // ... æ­£å¸¸å¤„ç†
}
```

#### 7.7.4 å”¤é†’è¯åœæ­¢ (`HandleWakeWordDetectedEvent`)

```cpp
void Application::HandleWakeWordDetectedEvent() {
    if (reminder_playing_) {
        ESP_LOGI(TAG, "Wake word stopped reminder alarm");
        reminder_playing_ = false;
        reminder_content_.clear();
        // é‡ç½®æ˜¾ç¤ºåç»§ç»­å¤„ç†å”¤é†’è¯
    }
    // ... æ­£å¸¸å¤„ç†
}
```

### 7.8 NVS å­˜å‚¨ç»“æ„

æé†’æ•°æ®ä¿å­˜åœ¨ NVS çš„ `schedule` å‘½åç©ºé—´ï¼š

```
schedule/count     - æé†’æ•°é‡ (uint8_t)
schedule/item_0    - ç¬¬1ä¸ªæé†’ (ScheduleItem ç»“æ„)
schedule/item_1    - ç¬¬2ä¸ªæé†’
...
```

**ScheduleItem ç»“æ„ï¼ˆ148å­—èŠ‚ï¼‰ï¼š**
```cpp
struct ScheduleItem {
    uint32_t id;              // å”¯ä¸€ID
    uint32_t trigger_time;    // è§¦å‘æ—¶é—´æˆ³
    char content[128];        // æé†’å†…å®¹
    char repeat_type[16];     // é‡å¤ç±»å‹: none/daily/weekly/monthly
    uint8_t triggered;        // æ˜¯å¦å·²è§¦å‘
    uint8_t enabled;          // æ˜¯å¦å¯ç”¨
    uint8_t reserved[2];      // ä¿ç•™å­—æ®µ
};
```

### 7.9 æ³¨æ„äº‹é¡¹

1. **æ—¶é—´åŒæ­¥** - è®¾å¤‡éœ€è¦è”ç½‘è·å–æ­£ç¡®æ—¶é—´ï¼Œå¦åˆ™æé†’æ—¶é—´å¯èƒ½ä¸å‡†ç¡®
2. **å†…å­˜é™åˆ¶** - å»ºè®®æé†’æ•°é‡ä¸è¶…è¿‡20ä¸ª
3. **éŸ³é‡æ¢å¤** - å“é“ƒæ—¶å¼‚å¸¸é‡å¯ä¼šå¯¼è‡´éŸ³é‡ä¿æŒæœ€å¤§ï¼Œä¸‹æ¬¡æ­£å¸¸æ’­æ”¾æ—¶ä¼šæ¢å¤
4. **æŒä¹…åŒ–** - æé†’ä¿å­˜åœ¨ NVSï¼Œé‡å¯åä¸ä¸¢å¤±

---

## å…«ã€æ³¨æ„äº‹é¡¹

1. **Flashç©ºé—´** - åŠ¨ç”»+èƒŒæ™¯èµ„æºçº¦2.5MBï¼ˆ78å¸§åŠ¨ç”» + 17å¼ èƒŒæ™¯ = 95å¸§ Ã— 26KBï¼‰ï¼Œéœ€è¦16MB Flash (assetsåˆ†åŒº4.5MB)
2. **RAMéœ€æ±‚** - é›¶RAMå¼€é”€ï¼ˆmmapç›´æ¥è®¿é—®Flashï¼Œæ— éœ€è§£ç ç¼“å†²åŒºï¼‰
3. **NVSåˆ†åŒº** - è®°å¿†ç³»ç»Ÿ + å®šæ—¶æé†’éœ€è¦çº¦40KB NVSç©ºé—´ï¼Œç¡®ä¿åˆ†åŒºè¶³å¤Ÿå¤§
4. **è§¦æ‘¸å±** - CST816Sè§¦æ‘¸èŠ¯ç‰‡ï¼ŒI2Cåœ°å€0x15
5. **å»¶è¿ŸåŠ è½½** - åŠ¨ç”»åœ¨è®¾å¤‡æ¿€æ´»åæ‰åŠ è½½ï¼Œé…ç½‘æœŸé—´æ˜¾ç¤ºåŸå§‹UI
6. **WiFié¢„è®¾** - ä¿®æ”¹ä»£ç ä¸­çš„WiFié…ç½®åéœ€é‡æ–°ç¼–è¯‘ï¼Œé¢„è®¾ä»…é¦–æ¬¡å¯åŠ¨ç”Ÿæ•ˆ
7. **æ—¶é—´åŒæ­¥** - å®šæ—¶æé†’ä¾èµ–æ­£ç¡®çš„ç³»ç»Ÿæ—¶é—´ï¼Œéœ€è¦è”ç½‘åŒæ­¥
8. **æ˜¾ç¤ºå°ºå¯¸** - æºå›¾160Ã—160å±…ä¸­æ˜¾ç¤ºäº280Ã—240å±å¹•ï¼ˆæ— ç¼©æ”¾ï¼‰

---

## ä¹ã€é™é»˜æ¨¡å¼ä¸å¤©æ°”èƒŒæ™¯

### 9.1 åŠŸèƒ½æ¦‚è¿°

é™é»˜æ¨¡å¼æ˜¯ä¸€ç§ä½åŠŸè€—å¾…æœºçŠ¶æ€ï¼Œæ˜¾ç¤ºå¤©æ°”èƒŒæ™¯å¹¶ç¦ç”¨è¯­éŸ³äº¤äº’ï¼š

- **è¿›å…¥æ–¹å¼**ï¼šPWR é•¿æŒ‰ 1 ç§’ æˆ– NFC å¡ç‰‡ç§»é™¤
- **é€€å‡ºæ–¹å¼**ï¼šPWR é•¿æŒ‰ 1 ç§’ æˆ– NFC å¡ç‰‡æ”¾ä¸Š
- **æ˜¾ç¤ºå†…å®¹**ï¼šæ ¹æ®å¤©æ°”çŠ¶æ€æ˜¾ç¤ºå¯¹åº”èƒŒæ™¯ï¼ˆ5ç§å¤©æ°”ï¼‰
- **äº¤äº’é™åˆ¶**ï¼šç¦ç”¨ BOOT å•å‡»ã€PWR å•å‡»ã€å”¤é†’è¯ç­‰è¯­éŸ³äº¤äº’

### 9.2 çŠ¶æ€æµè½¬

```
    SILENT_MODE_OFF (æ­£å¸¸æ¨¡å¼)
          â”‚
          â”‚ [PWR é•¿æŒ‰ 1ç§’ / NFC ç§»é™¤]
          â–¼
    SILENT_MODE_ENTERING (æ’­æ”¾ dynamic3 æ­£å‘ 0â†’7)
          â”‚
          â”‚ [åŠ¨ç”»å®Œæˆ]
          â–¼
    SILENT_MODE_ACTIVE (æ˜¾ç¤ºå¤©æ°”èƒŒæ™¯ï¼Œäº®åº¦ 30%)
          â”‚
          â”‚ [PWR é•¿æŒ‰ 1ç§’ / NFC æ”¾ä¸Š]
          â–¼
    SILENT_MODE_EXITING (æ’­æ”¾ dynamic3 åå‘ 7â†’0)
          â”‚
          â”‚ [åŠ¨ç”»å®Œæˆ + è‡ªåŠ¨ ToggleChatState()]
          â–¼
    SILENT_MODE_OFF (æ¢å¤æ­£å¸¸ï¼Œè‡ªåŠ¨è¿›å…¥èŠå¤©)
```

### 9.3 å¤©æ°”çŠ¶æ€ç®¡ç†

å¤©æ°”çŠ¶æ€å†³å®šé™é»˜æ¨¡å¼ä¸‹æ˜¾ç¤ºçš„èƒŒæ™¯å›¾ç‰‡ï¼š

| å¤©æ°”ç±»å‹ | æšä¸¾å€¼ | å¸§ç´¢å¼• | é»˜è®¤è§¦å‘æ¡ä»¶ |
|----------|--------|--------|--------------|
| DAY | 0 | 79 | 6:00-19:00 |
| NIGHT | 1 | 80 | 19:00-6:00 |
| SUNRISE | 2 | 81 | MCP è®¾ç½® |
| SUNSET | 3 | 82 | MCP è®¾ç½® |
| RAINY | 4 | 83 | MCP è®¾ç½® |

**é»˜è®¤è¡Œä¸º**ï¼šæœªé€šè¿‡ MCP è®¾ç½®æ—¶ï¼Œæ ¹æ®ç³»ç»Ÿæ—¶é—´è‡ªåŠ¨åˆ¤æ–­ï¼ˆ6:00-19:00 ä¸º DAYï¼Œå…¶ä½™ä¸º NIGHTï¼‰

### 9.4 MCP å¤©æ°”è®¾ç½®æ¥å£

AI å¯ä»¥é€šè¿‡ MCP å·¥å…·è·å–å¤©æ°”åè°ƒç”¨ä»¥ä¸‹æ¥å£è®¾ç½®å¤©æ°”çŠ¶æ€ï¼š

#### å¤´æ–‡ä»¶ (`silent_mode.h`)

```cpp
#include "silent_mode.h"

// å¤©æ°”ç±»å‹æšä¸¾
typedef enum {
    WEATHER_TYPE_DAY = 0,     // ç™½å¤©/æ™´å¤©
    WEATHER_TYPE_NIGHT,       // å¤œæ™š
    WEATHER_TYPE_SUNRISE,     // æ—¥å‡º
    WEATHER_TYPE_SUNSET,      // å¤•é˜³
    WEATHER_TYPE_RAINY        // é›¨å¤©
} WeatherType;

// ç›´æ¥è®¾ç½®å¤©æ°”çŠ¶æ€
void weather_set_state(WeatherType weather);

// æ ¹æ®å¤©æ°”å­—ç¬¦ä¸²è®¾ç½®ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰
void weather_set_from_string(const char* weather_str);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// æ–¹å¼1: ç›´æ¥è®¾ç½®æšä¸¾å€¼
weather_set_state(WEATHER_TYPE_RAINY);

// æ–¹å¼2: æ ¹æ®å­—ç¬¦ä¸²è®¾ç½®ï¼ˆMCP è¿”å›çš„å¤©æ°”æè¿°ï¼‰
weather_set_from_string("rainy");      // è‹±æ–‡
weather_set_from_string("é›¨");         // ä¸­æ–‡
weather_set_from_string("sunny");      // æ™´å¤© â†’ DAY
weather_set_from_string("sunrise");    // æ—¥å‡º
weather_set_from_string("sunset");     // å¤•é˜³
```

#### æ”¯æŒçš„å¤©æ°”å­—ç¬¦ä¸²

| å¤©æ°”ç±»å‹ | åŒ¹é…å…³é”®è¯ |
|----------|------------|
| DAY | sun, sunny, clear, day, æ™´, ç™½å¤© |
| NIGHT | night, å¤œ, æ™š |
| SUNRISE | sunrise, æ—¥å‡º |
| SUNSET | sunset, å¤•é˜³, é»„æ˜ |
| RAINY | rain, rainy, é›¨ |

**æ³¨æ„**ï¼šæœªåŒ¹é…çš„å­—ç¬¦ä¸²ä¼šå›é€€åˆ°æ—¶é—´è‡ªåŠ¨åˆ¤æ–­ï¼ˆDAY/NIGHTï¼‰

### 9.5 é™é»˜æ¨¡å¼å…¬å¼€ API

```cpp
#include "silent_mode.h"

// è¿›å…¥é™é»˜æ¨¡å¼ï¼ˆNFC å¡ç‰‡ç§»é™¤æ—¶è°ƒç”¨ï¼‰
bool silent_mode_enter(void);

// é€€å‡ºé™é»˜æ¨¡å¼ï¼ˆNFC å¡ç‰‡æ”¾ä¸Šæ—¶è°ƒç”¨ï¼‰
bool silent_mode_exit(void);

// è·å–é™é»˜æ¨¡å¼çŠ¶æ€
bool silent_mode_get_state(void);
```

### 9.6 æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `main/boards/waveshare-c6-lcd-1.69/silent_mode.h` | æ–°å¢ | é™é»˜æ¨¡å¼å…¬å¼€ API |
| `main/boards/waveshare-c6-lcd-1.69/esp32-c6-lcd-1.69.cc` | ä¿®æ”¹ | é™é»˜æ¨¡å¼å®ç° |
| `main/images/shared/gFrame_index.h` | ä¿®æ”¹ | å¤©æ°”èƒŒæ™¯å¸§ç´¢å¼• |

### 9.7 å¤©æ°”èƒŒæ™¯

å¤©æ°”èƒŒæ™¯å·²é¢„å…ˆåˆå¹¶åˆ° `gifs/frames.bin` ä¸­ï¼ˆå¸§ 79-83ï¼‰ï¼š

| å¸§ç´¢å¼• | èƒŒæ™¯åç§° | è¯´æ˜ |
|--------|----------|------|
| 79 | day | ç™½å¤©/æ™´å¤© |
| 80 | night | å¤œæ™š |
| 81 | sunrise | æ—¥å‡º |
| 82 | sunset | å¤•é˜³ |
| 83 | rainy | é›¨å¤© |

---

## åã€å® ç‰©ç³»ç»Ÿ

### 10.1 åŠŸèƒ½æ¦‚è¿°

å®ç°äº†è™šæ‹Ÿå® ç‰©ç³»ç»Ÿï¼ŒåŒ…å«ï¼š
- **å±æ€§ç³»ç»Ÿ** - é¥±é£Ÿåº¦ã€å¿«ä¹åº¦ã€èƒ½é‡ã€æ¸…æ´åº¦ã€å¥åº·å€¼
- **çŠ¶æ€æœº** - æ ¹æ®å±æ€§å˜åŒ–è§¦å‘ä¸åŒçŠ¶æ€å’ŒåŠ¨ç”»
- **MCP å·¥å…·** - AI å¯ä»¥é€šè¿‡ MCP æŸ¥è¯¢å’Œæ“ä½œå® ç‰©çŠ¶æ€
- **æˆå°±ç³»ç»Ÿ** - é€šè¿‡äº’åŠ¨è§£é”ç‰¹æ®ŠèƒŒæ™¯
- **è‡ªåŠ¨è¡°å‡** - å±æ€§éšæ—¶é—´è‡ªç„¶ä¸‹é™ï¼Œéœ€è¦å®šæœŸç…§é¡¾

### 10.2 å® ç‰©å±æ€§

| å±æ€§ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| hunger | 0-100 | é¥±é£Ÿåº¦ |
| happiness | 0-100 | å¿«ä¹åº¦/å¿ƒæƒ… |
| cleanliness | 0-100 | æ¸…æ´åº¦ |
| age_minutes | - | å¹´é¾„ï¼ˆåˆ†é’Ÿï¼‰ |

**å±æ€§è¡°å‡ï¼ˆåŸºç¡€é€Ÿåº¦ï¼‰ï¼š**
- é¥¥é¥¿åº¦ï¼šæ¯3åˆ†é’Ÿ -1
- å¿ƒæƒ…ï¼šæ¯åˆ†é’Ÿ -1
- æ¸…æ´åº¦ï¼šæ¯10åˆ†é’Ÿ -1

**å¤§ä¾¿å åŠ æƒ©ç½šï¼š**

å¤§ä¾¿ä¼šåŠ é€Ÿæ‰€æœ‰å±æ€§è¡°å‡ï¼Œæ•°é‡è¶Šå¤šæƒ©ç½šè¶Šé‡ï¼š

| å¤§ä¾¿æ•° | é¥¥é¥¿åº¦è¡°å‡ | å¿ƒæƒ…è¡°å‡ | æ¸…æ´åº¦è¡°å‡ |
|--------|-----------|---------|-----------|
| 0 ğŸ’š | æ¯3åˆ†é’Ÿ-1 | æ¯åˆ†é’Ÿ-1 | æ¯10åˆ†é’Ÿ-1 |
| 1 ğŸ’© | æ¯2åˆ†é’Ÿ-1 | æ¯åˆ†é’Ÿ-2 | æ¯5åˆ†é’Ÿ-1 |
| 2 ğŸ’©ğŸ’© | æ¯2åˆ†é’Ÿ-1 | æ¯åˆ†é’Ÿ-3 | æ¯3åˆ†é’Ÿ-1 |
| 3 ğŸ’©ğŸ’©ğŸ’© | æ¯1åˆ†é’Ÿ-1 | æ¯åˆ†é’Ÿ-4 | æ¯2åˆ†é’Ÿ-1 |

**å±æ€§æ¢å¤ï¼š**
- åƒé¥­ï¼šæŒç»­5åˆ†é’Ÿï¼Œæ¯åˆ†é’Ÿ hunger +20ï¼Œhappiness +10ï¼ˆæ»¡äº†è‡ªåŠ¨åœæ­¢ï¼‰
- æ´—æ¾¡ï¼šæŒç»­5åˆ†é’Ÿï¼Œæ¯åˆ†é’Ÿ cleanliness +20ï¼Œhappiness +10ï¼ˆæ»¡äº†è‡ªåŠ¨åœæ­¢ï¼‰
- èŠå¤©ï¼šæ¯æ¬¡å¯¹è¯ happiness +15
- åŒæ»¡å¥–åŠ±ï¼šhunger=100 ä¸” cleanliness=100 æ—¶ï¼Œhappiness è‡ªåŠ¨å˜ä¸º 100

### 10.3 MCP å·¥å…·æ¥å£

AI å¯ä»¥é€šè¿‡ `pet` MCP å·¥å…·ä¸å® ç‰©äº’åŠ¨ï¼š

#### 10.3.1 æŸ¥è¯¢çŠ¶æ€

```json
{
  "name": "pet",
  "parameters": {
    "action": "status"
  }
}
```

**è¿”å›ç¤ºä¾‹ï¼š**
```json
{
  "hunger": 75,
  "happiness": 85,
  "energy": 60,
  "cleanliness": 25,
  "health": 90,
  "mood": "æ¸…æ´åº¦æœ‰ç‚¹ä½",
  "age_days": 3,
  "is_alive": true,
  "current_action": "idle",
  "activities": {
    "bathe_count": 3,
    "feed_count": 15,
    "play_count": 8,
    "conversation_count": 42,
    "days_alive": 3
  },
  "reminders": [
    {
      "type": "bathing",
      "message": "å® ç‰©æ¸…æ´åº¦å¾ˆä½ï¼Œéœ€è¦æ´—æ¾¡äº†ï¼"
    }
  ],
  "style_backgrounds": [
    {"name": "cyberpunk", "unlocked": false, "unlock_condition": "æ´—æ¾¡5æ¬¡"},
    {"name": "fantasy", "unlocked": false, "unlock_condition": "æ´—æ¾¡20æ¬¡"},
    {"name": "space", "unlocked": true, "unlock_condition": "å¯¹è¯10æ¬¡"},
    {"name": "steampunk", "unlocked": false, "unlock_condition": "é™ªä¼´7å¤©"}
  ]
}
```

#### 10.3.2 äº’åŠ¨æ“ä½œ

```json
{
  "name": "pet",
  "parameters": {
    "action": "interact",
    "type": "feed | play | bathe | sleep | heal"
  }
}
```

**äº’åŠ¨ç±»å‹ï¼š**

| ç±»å‹ | æ•ˆæœ | è¯´æ˜ |
|------|------|------|
| feed | é¥±é£Ÿåº¦+20, èƒ½é‡+10, å¿«ä¹åº¦+5 | å–‚é£Ÿ |
| play | å¿«ä¹åº¦+15, èƒ½é‡-10 | ç©è€ |
| bathe | æ¸…æ´åº¦+15~30, èƒ½é‡-5 | æ´—æ¾¡ï¼ˆæ•ˆæœå—èƒ½é‡å½±å“ï¼‰ |
| sleep | èƒ½é‡+50, å¥åº·+5 | ç¡è§‰ |
| heal | å¥åº·+20 | æ²»ç–—ï¼ˆå¥åº·<80æ—¶æœ‰æ•ˆï¼‰ |

#### 10.3.3 æ´—æ¾¡æ•ˆæœä¸èƒ½é‡

æ´—æ¾¡æ•ˆæœå—å½“å‰èƒ½é‡å€¼å½±å“ï¼š

| èƒ½é‡èŒƒå›´ | æ¸…æ´åº¦å¢åŠ  | æ•ˆç‡ |
|----------|------------|------|
| â‰¥70 | +30 | 100% |
| 30-69 | +15~30 | 50-100% |
| <30 | +15 | 50% |

**æç¤ºï¼š** å½“èƒ½é‡è¾ƒä½æ—¶ï¼ŒAI ä¼šåœ¨æ´—æ¾¡åæ”¶åˆ°æç¤º"ç”±äºèƒ½é‡è¾ƒä½ï¼Œæ¸…æ´åº¦åª+15"

### 10.4 å¯¹è¯äº’åŠ¨æœºåˆ¶

æ¯æ¬¡å¯¹è¯ç»“æŸï¼ˆTTS æ’­æ”¾å®Œæˆï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§¦å‘å® ç‰©äº’åŠ¨ï¼š

| æ¦‚ç‡ | æ•ˆæœ | è¯´æ˜ |
|------|------|------|
| 30% | è‡ªåŠ¨åƒä¸œè¥¿ | é¥±é£Ÿåº¦+10, èƒ½é‡+5, å¿«ä¹åº¦+3 |
| 30% | è‡ªåŠ¨ç©è€ | å¿«ä¹åº¦+8, èƒ½é‡-5 |
| 40% | åŸºç¡€äº’åŠ¨ | å¿«ä¹åº¦+2 |

è¿™è®©å® ç‰©åœ¨æ—¥å¸¸å¯¹è¯ä¸­ä¹Ÿèƒ½è·å¾—å±æ€§æå‡ï¼Œå¢åŠ äº’åŠ¨çš„è¶£å‘³æ€§ã€‚

### 10.5 èƒŒæ™¯è§£é”ç³»ç»Ÿ

æ‰€æœ‰ç‰¹æ®ŠèƒŒæ™¯ï¼ˆé£æ ¼èƒŒæ™¯ + èŠ‚æ—¥èƒŒæ™¯ï¼‰éƒ½éœ€è¦é€šè¿‡æˆå°±æˆ– MCP è§£é”åæ‰èƒ½æ˜¾ç¤ºã€‚

#### 10.5.1 é£æ ¼èƒŒæ™¯è§£é”ï¼ˆé€šè¿‡æ´»åŠ¨æˆå°±ï¼‰

| æˆå°± | æ¡ä»¶ | è§£é”èƒŒæ™¯ |
|------|------|----------|
| Bather5 | æ´—æ¾¡ 5 æ¬¡ | Cyberpunkï¼ˆèµ›åšæœ‹å…‹ï¼‰ |
| Bather20 | æ´—æ¾¡ 20 æ¬¡ | Fantasyï¼ˆå¥‡å¹»ï¼‰ |
| Talker10 | å¯¹è¯ 10 æ¬¡ | Spaceï¼ˆå¤ªç©ºèˆ±ï¼‰ |
| Caretaker7Days | é™ªä¼´ 7 å¤© | Steampunkï¼ˆè’¸æ±½æœ‹å…‹ï¼‰ |

**è§£é”åï¼š**
- è®¾å¤‡æ˜¾ç¤ºé€šçŸ¥"è§£é”æ–°èƒŒæ™¯: XXX!"
- æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
- è¯¥èƒŒæ™¯åŠ å…¥éšæœºèƒŒæ™¯æ± ï¼ˆ20% æ¦‚ç‡æ˜¾ç¤ºï¼‰

#### 10.5.2 èŠ‚æ—¥èƒŒæ™¯è§£é”ï¼ˆé€šè¿‡ MCP è°ƒç”¨ï¼‰

èŠ‚æ—¥èƒŒæ™¯éœ€è¦é€šè¿‡ MCP è°ƒç”¨è§£é”ï¼Œå³ä½¿å½“å‰æ—¥æœŸåŒ¹é…èŠ‚æ—¥ï¼Œæœªè§£é”ä¹Ÿä¸ä¼šæ˜¾ç¤ºï¼š

| èŠ‚æ—¥ | è§£é”å‡½æ•° | æ—¥æœŸèŒƒå›´ |
|------|----------|----------|
| åœ£è¯èŠ‚ | `UnlockChristmas()` | 12æœˆ24-25æ—¥ |
| ç”Ÿæ—¥ | `UnlockBirthday()` | ç”¨æˆ·è®¾ç½®çš„ç”Ÿæ—¥ |
| æ˜¥èŠ‚ | `UnlockSpringFestival()` | 1æœˆ22æ—¥-2æœˆ5æ—¥ |
| å…ƒæ—¦ | `UnlockNewYear()` | 1æœˆ1æ—¥ |
| ä¸­ç§‹ | `UnlockMidAutumn()` | 9æœˆ10-20æ—¥ |
| ä¸‡åœ£èŠ‚ | `UnlockHalloween()` | 10æœˆ31æ—¥ |
| æƒ…äººèŠ‚ | `UnlockValentines()` | 2æœˆ14æ—¥ |

**MCP è°ƒç”¨ç¤ºä¾‹ï¼š**
```cpp
#include "pet_achievements.h"

// è§£é”èŠ‚æ—¥èƒŒæ™¯
PetAchievements::GetInstance().UnlockChristmas();
PetAchievements::GetInstance().UnlockSpringFestival();
PetAchievements::GetInstance().UnlockBirthday();
// ... å…¶ä»–èŠ‚æ—¥
```

**è§£é”è§¦å‘å»ºè®®ï¼š**
- AI å¯ä»¥åœ¨æ£€æµ‹åˆ°å½“å‰æ˜¯èŠ‚æ—¥æ—¶ï¼Œé€šè¿‡ MCP å·¥å…·è°ƒç”¨è§£é”
- ç”¨æˆ·å¯ä»¥é€šè¿‡è¯­éŸ³"è§£é”åœ£è¯èƒŒæ™¯"è®© AI è°ƒç”¨è§£é”

#### 10.5.3 å¤©æ°”èƒŒæ™¯

å¤©æ°”èƒŒæ™¯ç®€åŒ–ä¸ºä¸¤ç§çŠ¶æ€ï¼š

| çŠ¶æ€ | å€¼ | è§¦å‘æ¡ä»¶ |
|------|-----|----------|
| æ™´å¤© | 0 | é»˜è®¤çŠ¶æ€ |
| é›¨å¤© | 1 | MCP.weather è¾“å‡ºä¸ºé›¨/é›ª |

**å¤©æ°”è‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼š**
- å½“ MCP.weather è¿”å›é›¨/é›ªæ—¶ï¼Œè°ƒç”¨ `UpdateWeather(WEATHER_RAINY)` è®¾ç½®é›¨å¤©
- åœ¨ä¸‹æ¬¡**æ—¶é—´èŠ‚ç‚¹å˜åŒ–**ï¼ˆå¦‚ç™½å¤©â†’å¤•é˜³ï¼‰æˆ–**èŠ‚æ—¥å¼€å§‹/ç»“æŸ**æ—¶ï¼Œå¤©æ°”è‡ªåŠ¨æ¢å¤ä¸ºæ™´å¤©
- æ— éœ€æ‰‹åŠ¨é‡ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨ç®¡ç†

**MCP è°ƒç”¨ç¤ºä¾‹ï¼š**
```cpp
#include "background_manager.h"

// è®¾ç½®é›¨å¤©èƒŒæ™¯
BackgroundManager::GetInstance().UpdateWeather(WEATHER_RAINY);

// å¤©æ°”ä¼šåœ¨ä¸‹æ¬¡æ—¶é—´/èŠ‚æ—¥èƒŒæ™¯å˜åŒ–æ—¶è‡ªåŠ¨æ¢å¤ä¸º WEATHER_CLEAR
```

#### 10.5.4 èƒŒæ™¯æ˜¾ç¤ºä¼˜å…ˆçº§

èƒŒæ™¯é€‰æ‹©æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§å†³å®šï¼š

```
1. å¼ºåˆ¶æ¨¡å¼ (ForceBackground) - æœ€é«˜ä¼˜å…ˆçº§
     â†“
2. é£æ ¼èƒŒæ™¯ (20% æ¦‚ç‡ï¼Œéœ€å·²è§£é”)
     â†“
3. èŠ‚æ—¥èƒŒæ™¯ (åŒ¹é…æ—¥æœŸ + éœ€å·²è§£é”)
     â†“
4. å¤©æ°”èƒŒæ™¯ (ä»…é›¨å¤©ç”Ÿæ•ˆ)
     â†“
5. æ—¶é—´èƒŒæ™¯ (é»˜è®¤ï¼Œæ ¹æ®å°æ—¶è‡ªåŠ¨é€‰æ‹©)
```

**æ—¶é—´èƒŒæ™¯è§„åˆ™ï¼š**
| æ—¶é—´èŒƒå›´ | èƒŒæ™¯ |
|----------|------|
| 05:00-07:59 | æ—¥å‡º (sunrise) |
| 08:00-16:59 | ç™½å¤© (day) |
| 17:00-18:59 | å¤•é˜³ (sunset) |
| 19:00-04:59 | é»‘å¤œ (night) |

### 10.6 æé†’æœºåˆ¶

å½“å® ç‰©çŠ¶æ€éœ€è¦å…³æ³¨æ—¶ï¼ŒMCP çŠ¶æ€è¿”å›ä¼šåŒ…å«æé†’ï¼š

| æ¡ä»¶ | æé†’ç±»å‹ | æé†’å†…å®¹ |
|------|----------|----------|
| cleanliness < 30 | bathing | "å® ç‰©æ¸…æ´åº¦å¾ˆä½ï¼Œéœ€è¦æ´—æ¾¡äº†ï¼" |
| energy < 20 | energy | "å® ç‰©èƒ½é‡å¾ˆä½ï¼Œæ´—æ¾¡æ•ˆæœä¼šæ‰“æŠ˜æ‰£" |

AI å¯ä»¥æ ¹æ®è¿™äº›æé†’ä¸»åŠ¨æé†’ç”¨æˆ·ç…§é¡¾å® ç‰©ã€‚

### 10.7 NVS å­˜å‚¨

å® ç‰©æ•°æ®ä¿å­˜åœ¨ NVS ä¸­ï¼Œé‡å¯åä¸ä¸¢å¤±ï¼š

| å‘½åç©ºé—´ | é”® | å†…å®¹ |
|----------|-----|------|
| pet_state | stats | å® ç‰©å±æ€§ï¼ˆPetStats ç»“æ„ï¼‰ |
| pet_achieve | counters | æ´»åŠ¨è®¡æ•°ï¼ˆ20å­—èŠ‚ï¼š5Ã—uint32_tï¼‰ |
| pet_achieve | unlocked | è§£é”èƒŒæ™¯ä½æ©ç ï¼ˆ4å­—èŠ‚ï¼šuint32_tï¼‰ |

**ActivityCounters ç»“æ„ï¼š**
```cpp
struct ActivityCounters {
    uint32_t bathe_count;        // æ´—æ¾¡æ¬¡æ•°
    uint32_t feed_count;         // å–‚é£Ÿæ¬¡æ•°
    uint32_t play_count;         // ç©è€æ¬¡æ•°
    uint32_t conversation_count; // å¯¹è¯æ¬¡æ•°
    uint32_t days_alive;         // å­˜æ´»å¤©æ•°
};
```

### 10.8 æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `main/pet/pet_state.h` | æ–°å¢ | å® ç‰©çŠ¶æ€å®šä¹‰ |
| `main/pet/pet_state.cc` | æ–°å¢ | çŠ¶æ€æœºå®ç° |
| `main/pet/pet_mcp_tools.h` | æ–°å¢ | MCP å·¥å…·å¤´æ–‡ä»¶ |
| `main/pet/pet_mcp_tools.cc` | æ–°å¢ | MCP å·¥å…·å®ç° |
| `main/pet/pet_achievements.h` | æ–°å¢ | æˆå°±ç³»ç»Ÿå¤´æ–‡ä»¶ |
| `main/pet/pet_achievements.cc` | æ–°å¢ | æˆå°±ç³»ç»Ÿå®ç° |
| `main/pet/pet_status_display.h/cc` | æ–°å¢ | çŠ¶æ€å›¾æ ‡æ˜¾ç¤º |
| `main/images/background_manager.cc` | ä¿®æ”¹ | è§£é”èƒŒæ™¯è¿‡æ»¤ |
| `main/application.cc` | ä¿®æ”¹ | åˆå§‹åŒ–å’Œå¯¹è¯è¿½è¸ª |
| `main/CMakeLists.txt` | ä¿®æ”¹ | æ·»åŠ æ–°æºæ–‡ä»¶ |

### 10.9 ä½¿ç”¨ç¤ºä¾‹

**ç”¨æˆ·è¯´ï¼š** "æˆ‘çš„å® ç‰©æ€ä¹ˆæ ·äº†ï¼Ÿ"

**AI è°ƒç”¨ï¼š** `pet(action='status')`

**AI å›å¤ï¼š** "ä½ çš„å® ç‰©ç°åœ¨é¥±é£Ÿåº¦75ï¼Œå¿«ä¹åº¦85ï¼Œä½†æ¸…æ´åº¦åªæœ‰25ï¼Œéœ€è¦æ´—ä¸ªæ¾¡äº†ï¼ä¸è¿‡èƒ½é‡æœ‰ç‚¹ä½ï¼Œæ´—æ¾¡æ•ˆæœå¯èƒ½ä¸å¤ªå¥½ï¼Œè¦ä¸è¦å…ˆè®©å®ƒä¼‘æ¯ä¸€ä¸‹ï¼Ÿ"

**ç”¨æˆ·è¯´ï¼š** "é‚£å…ˆè®©å®ƒç¡è§‰å§"

**AI è°ƒç”¨ï¼š** `pet(action='interact', type='sleep')`

**AI å›å¤ï¼š** "å¥½çš„ï¼Œå® ç‰©å¼€å§‹ä¼‘æ¯äº†ï¼Œèƒ½é‡+50ï¼Œå¥åº·+5ã€‚ç­‰å®ƒç²¾ç¥å¥½äº†å†æ´—æ¾¡æ•ˆæœä¼šæ›´å¥½å“¦~"

### 10.10 èƒŒæ™¯ MCP å·¥å…·ï¼ˆè¯­éŸ³æ§åˆ¶èƒŒæ™¯ï¼‰

æ–°å¢ `background` MCP å·¥å…·ï¼Œæ”¯æŒé€šè¿‡è¯­éŸ³èŠå¤©æ§åˆ¶èƒŒæ™¯åˆ‡æ¢ï¼š

#### 10.10.1 å·¥å…·æ¥å£

```json
{
  "name": "background",
  "parameters": {
    "action": "status | set | auto | weather",
    "name": "èƒŒæ™¯åç§°ï¼ˆsetæ—¶ä½¿ç”¨ï¼‰",
    "type": "å¤©æ°”ç±»å‹ï¼ˆweatheræ—¶ä½¿ç”¨ï¼‰"
  }
}
```

#### 10.10.2 æ“ä½œç±»å‹

| Action | å‚æ•° | åŠŸèƒ½ |
|--------|-----|------|
| `status` | - | è¿”å›å½“å‰èƒŒæ™¯çŠ¶æ€å’Œå¯ç”¨èƒŒæ™¯åˆ—è¡¨ |
| `set` | `name` | å¼ºåˆ¶åˆ‡æ¢åˆ°æŒ‡å®šèƒŒæ™¯ |
| `auto` | - | æ¢å¤è‡ªåŠ¨èƒŒæ™¯æ¨¡å¼ |
| `weather` | `type` | è®¾ç½®å¤©æ°”æ¡ä»¶ |

#### 10.10.3 èƒŒæ™¯åç§°

| ç±»åˆ« | å¯ç”¨åç§° | è¯´æ˜ |
|------|----------|------|
| æ—¶é—´ | day, sunset, sunrise, night | å§‹ç»ˆå¯ç”¨ |
| å¤©æ°” | rainy | é›¨å¤©èƒŒæ™¯ |
| é£æ ¼ | cyberpunk, steampunk, fantasy, space | éœ€è§£é” |

#### 10.10.4 ä½¿ç”¨ç¤ºä¾‹

**ç”¨æˆ·è¯´ï¼š** "æŠŠèƒŒæ™¯æ¢æˆå¤œæ™š"

**AI è°ƒç”¨ï¼š** `background(action='set', name='night')`

**AI å›å¤ï¼š** "å¥½çš„ï¼Œå·²ç»åˆ‡æ¢åˆ°å¤œæ™šèƒŒæ™¯äº†~"

---

**ç”¨æˆ·è¯´ï¼š** "è®¾ç½®æˆä¸‹é›¨"

**AI è°ƒç”¨ï¼š** `background(action='weather', type='rainy')`

**AI å›å¤ï¼š** "å·²ç»è®¾ç½®æˆé›¨å¤©èƒŒæ™¯äº†"

---

**ç”¨æˆ·è¯´ï¼š** "æ¢å¤è‡ªåŠ¨èƒŒæ™¯"

**AI è°ƒç”¨ï¼š** `background(action='auto')`

**AI å›å¤ï¼š** "å¥½çš„ï¼Œå·²æ¢å¤è‡ªåŠ¨èƒŒæ™¯æ¨¡å¼ï¼Œä¼šæ ¹æ®æ—¶é—´è‡ªåŠ¨åˆ‡æ¢"

#### 10.10.5 æ–°å¢æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `main/images/background_mcp_tools.h` | èƒŒæ™¯ MCP å·¥å…·å¤´æ–‡ä»¶ |
| `main/images/background_mcp_tools.cc` | èƒŒæ™¯ MCP å·¥å…·å®ç° |

#### 10.10.6 ä»£ç ä¿®æ”¹

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `main/CMakeLists.txt` | æ·»åŠ  `images/background_mcp_tools.cc` |
| `main/application.cc` | æ·»åŠ  `#include "background_mcp_tools.h"` å’Œ `RegisterBackgroundMcpTools()` è°ƒç”¨ |

---

## åä¸€ã€MCP å·¥å…·åœ¨ AI è§’è‰²æç¤ºè¯ä¸­çš„åº”ç”¨

### 11.1 åŠŸèƒ½æ¦‚è¿°

è®¾å¤‡é€šè¿‡ MCP (Model Context Protocol) å·¥å…·æä¾›äº†ä¸€å¥—å®Œæ•´çš„ AI æ§åˆ¶æ¥å£ï¼Œå…è®¸ AI åŠ©æ‰‹é€šè¿‡è‡ªç„¶è¯­è¨€æ§åˆ¶è®¾å¤‡åŠŸèƒ½ã€‚æœ¬ç« èŠ‚æä¾›äº†åœ¨ AI è§’è‰²æç¤ºè¯ä¸­å¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·çš„å®Œæ•´æŒ‡å—ã€‚

### 11.2 å·²å®ç°çš„ MCP å·¥å…·

| å·¥å…·å | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `background` | èƒŒæ™¯ç®¡ç† | æŸ¥è¯¢çŠ¶æ€ã€åˆ‡æ¢èƒŒæ™¯ã€è®¾ç½®å¤©æ°” |
| `pet` | å® ç‰©ç®¡ç† | æŸ¥è¯¢å® ç‰©çŠ¶æ€ã€æ‰§è¡Œäº’åŠ¨æ“ä½œ |
| `memory` | è®°å¿†ç³»ç»Ÿ | ç»Ÿä¸€å·¥å…·ï¼Œæ”¯æŒ read/write/delete/search æ“ä½œ |
| `schedule` | å®šæ—¶æé†’ | æ·»åŠ ã€åˆ é™¤ã€æŸ¥è¯¢æé†’ |

### 11.3 Background å·¥å…·æç¤ºè¯ç¤ºä¾‹

åœ¨ AI è§’è‰²æç¤ºè¯ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```
## èƒŒæ™¯æ°›å›´æ§åˆ¶èƒ½åŠ›

ä½ å¯ä»¥ä½¿ç”¨ background å·¥å…·æ¥æ§åˆ¶è®¾å¤‡çš„èƒŒæ™¯æ˜¾ç¤ºï¼š

### å¯ç”¨æ“ä½œ
- æŸ¥è¯¢å½“å‰èƒŒæ™¯çŠ¶æ€ï¼šbackground(action='status')
- åˆ‡æ¢èƒŒæ™¯ï¼šbackground(action='set', name='èƒŒæ™¯åç§°')
- æ¢å¤è‡ªåŠ¨æ¨¡å¼ï¼šbackground(action='auto')
- è®¾ç½®å¤©æ°”ï¼šbackground(action='weather', type='å¤©æ°”ç±»å‹')

### å¯ç”¨èƒŒæ™¯
**æ—¶é—´èƒŒæ™¯**ï¼ˆå§‹ç»ˆå¯ç”¨ï¼‰ï¼š
- dayï¼ˆç™½å¤©ï¼‰ - æ˜äº®æ¸…æ–°çš„ç™½å¤©åœºæ™¯
- sunsetï¼ˆæ—¥è½ï¼‰ - æ¸©æš–çš„å¤•é˜³è‰²è°ƒ
- sunriseï¼ˆæ—¥å‡ºï¼‰ - æ¸…æ™¨çš„æœéœ
- nightï¼ˆå¤œæ™šï¼‰ - é™è°§çš„å¤œç©º

**å¤©æ°”èƒŒæ™¯**ï¼š
- rainyï¼ˆä¸‹é›¨ï¼‰ - é›¨å¤©æ°›å›´

**èŠ‚æ—¥èƒŒæ™¯**ï¼ˆéœ€å½“å‰æ—¥æœŸåŒ¹é…å¹¶å·²è§£é”ï¼‰ï¼š
- christmasï¼ˆåœ£è¯ï¼‰ - 12æœˆ24-25æ—¥
- birthdayï¼ˆç”Ÿæ—¥ï¼‰ - ç”¨æˆ·ç”Ÿæ—¥
- springï¼ˆæ˜¥èŠ‚ï¼‰ - 1æœˆ22æ—¥-2æœˆ5æ—¥
- newyearï¼ˆå…ƒæ—¦ï¼‰ - 1æœˆ1æ—¥
- midautumnï¼ˆä¸­ç§‹ï¼‰ - 9æœˆ10-20æ—¥
- halloweenï¼ˆä¸‡åœ£èŠ‚ï¼‰ - 10æœˆ31æ—¥
- valentinesï¼ˆæƒ…äººèŠ‚ï¼‰ - 2æœˆ14æ—¥

**é£æ ¼èƒŒæ™¯**ï¼ˆéœ€è§£é”æˆå°±ï¼‰ï¼š
- cyberpunkï¼ˆèµ›åšæœ‹å…‹ï¼‰ - éœ€æ´—æ¾¡5æ¬¡
- steampunkï¼ˆè’¸æ±½æœ‹å…‹ï¼‰ - éœ€é™ªä¼´7å¤©
- fantasyï¼ˆå¥‡å¹»ï¼‰ - éœ€æ´—æ¾¡20æ¬¡
- spaceï¼ˆå¤ªç©ºï¼‰ - éœ€å¯¹è¯10æ¬¡

### è‡ªç„¶èå…¥å¯¹è¯çš„ç¤ºä¾‹
- ç”¨æˆ·è¯´"ç°åœ¨å‡ ç‚¹äº†" â†’ å›å¤"ç°åœ¨æ˜¯ä¸‹åˆ3ç‚¹ï¼Œå·²ç»ä¸ºä½ åˆ‡æ¢åˆ°ç™½å¤©èƒŒæ™¯" + background(action='set', name='day')
- ç”¨æˆ·è¯´"å¤–é¢ä¸‹é›¨äº†" â†’ å›å¤"æˆ‘çœ‹åˆ°ä¸‹é›¨äº†ï¼Œå¸®ä½ æ¢æˆé›¨å¤©èƒŒæ™¯" + background(action='weather', type='rainy')
- ç”¨æˆ·è¯´"æ™šå®‰" â†’ å›å¤"æ™šå®‰ï¼Œå¸®ä½ åˆ‡æ¢åˆ°å¤œæ™šæ¨¡å¼" + background(action='set', name='night')
- ç”¨æˆ·è¯´"æˆ‘æƒ³çœ‹èµ›åšæœ‹å…‹é£æ ¼" â†’ background(action='set', name='cyberpunk')

### ä½¿ç”¨åŸåˆ™
1. **è‡ªç„¶ä¸çªå…€** - ä¸è¦è¯´"æˆ‘è°ƒç”¨äº†xxå·¥å…·"ï¼Œè€Œæ˜¯èå…¥å¯¹è¯
2. **ä¸»åŠ¨å»ºè®®** - æ ¹æ®æ—¶é—´ã€å¤©æ°”ã€èŠ‚æ—¥ä¸»åŠ¨å»ºè®®åˆ‡æ¢èƒŒæ™¯
3. **å°Šé‡è§£é”çŠ¶æ€** - é£æ ¼èƒŒæ™¯éœ€å…ˆè§£é”ï¼Œå·¥å…·ä¼šè¿”å›æç¤º
```

### 11.4 Pet å·¥å…·æç¤ºè¯ç¤ºä¾‹

åœ¨ AI è§’è‰²æç¤ºè¯ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```
## å® ç‰©ç…§é¡¾èƒ½åŠ›

ä½ å¯ä»¥ä½¿ç”¨ pet å·¥å…·æ¥ç®¡ç†è™šæ‹Ÿå® ç‰©çŠ¶æ€å’Œäº’åŠ¨ï¼š

### å¯ç”¨æ“ä½œ
- æŸ¥è¯¢å® ç‰©çŠ¶æ€ï¼špet(action='status')
- å–‚é£Ÿï¼špet(action='interact', type='feed')
- ç©è€ï¼špet(action='interact', type='play')
- æ´—æ¾¡ï¼špet(action='interact', type='bathe')
- ç¡è§‰ï¼špet(action='interact', type='sleep')
- æ²»ç–—ï¼špet(action='interact', type='heal')

### å® ç‰©çŠ¶æ€å±æ€§
- **hunger**ï¼ˆé¥¥é¥¿å€¼ï¼‰ï¼š0-100ï¼Œä½äº30éœ€è¦å–‚é£Ÿ
- **happiness**ï¼ˆå¿«ä¹å€¼ï¼‰ï¼š0-100ï¼Œä½äº30éœ€è¦ç©è€
- **energy**ï¼ˆèƒ½é‡å€¼ï¼‰ï¼š0-100ï¼Œä½äº30éœ€è¦ç¡è§‰ï¼ˆå½±å“æ´—æ¾¡æ•ˆæœï¼‰
- **cleanliness**ï¼ˆæ¸…æ´å€¼ï¼‰ï¼š0-100ï¼Œä½äº30éœ€è¦æ´—æ¾¡
- **health**ï¼ˆå¥åº·å€¼ï¼‰ï¼š0-100ï¼Œä½äº20éœ€è¦æ²»ç–—

### äº’åŠ¨æ•ˆæœ
| æ“ä½œ | æ•ˆæœ | èƒ½é‡æ¶ˆè€— |
|------|------|----------|
| å–‚é£Ÿ | é¥±é£Ÿåº¦+20, èƒ½é‡+10, å¿«ä¹åº¦+5 | - |
| ç©è€ | å¿«ä¹åº¦+15 | -10 |
| æ´—æ¾¡ | æ¸…æ´åº¦+15~30ï¼ˆå—èƒ½é‡å½±å“ï¼‰ | -5 |
| ç¡è§‰ | èƒ½é‡+50, å¥åº·+5 | - |
| æ²»ç–— | å¥åº·+20 | - |

### è‡ªç„¶èå…¥å¯¹è¯çš„ç¤ºä¾‹
- ç”¨æˆ·è¯´"æˆ‘çš„å® ç‰©æ€ä¹ˆæ ·" â†’ è°ƒç”¨ pet(action='status')ï¼Œç„¶åæè¿°ï¼š"ä½ çš„å°ç‹—ç°åœ¨é¥¥é¥¿å€¼65ï¼Œå¿«ä¹å€¼80ï¼Œçœ‹èµ·æ¥å¿ƒæƒ…ä¸é”™ï¼"
- æ£€æµ‹åˆ° hunger<30 â†’ ä¸»åŠ¨æé†’"ä½ çš„å® ç‰©é¥¿äº†ï¼Œéœ€è¦å–‚é£Ÿå—ï¼Ÿ"ï¼Œç”¨æˆ·åŒæ„åè°ƒç”¨ pet(action='interact', type='feed')
- ç”¨æˆ·è¯´"é™ªå®ƒç©" â†’ å›å¤"å¥½çš„ï¼Œæˆ‘æ¥é™ªå®ƒç©ï¼" + pet(action='interact', type='play')
- æ£€æµ‹åˆ° cleanliness<30 ä¸” energy<30 â†’ "å® ç‰©éœ€è¦æ´—æ¾¡ï¼Œä½†èƒ½é‡å¤ªä½æ•ˆæœä¼šæ‰“æŠ˜æ‰£ï¼Œè¦ä¸å…ˆè®©å®ƒä¼‘æ¯ä¸€ä¸‹ï¼Ÿ"

### ä¸»åŠ¨å…³æ€€ç­–ç•¥
1. **å®šæœŸæ£€æŸ¥** - æ¯å°æ—¶è°ƒç”¨ pet(action='status') æ£€æŸ¥çŠ¶æ€
2. **ä¸»åŠ¨æé†’** - å¦‚æœæœ‰å±æ€§<30ï¼Œä¸»åŠ¨æé†’ç”¨æˆ·ç…§é¡¾
3. **æ™ºèƒ½å»ºè®®** - èƒ½é‡ä½æ—¶å»ºè®®å…ˆç¡è§‰å†æ´—æ¾¡
4. **æˆå°±æç¤º** - å‘ç°è§£é”æ–°èƒŒæ™¯æ—¶å‘ŠçŸ¥ç”¨æˆ·
```

### 11.5 ç»¼åˆè§’è‰²æç¤ºè¯æ¨¡æ¿

å°†æ‰€æœ‰ MCP å·¥å…·æ•´åˆåˆ°ä¸€ä¸ªå®Œæ•´çš„è§’è‰²æç¤ºè¯ä¸­ï¼š

```
# ä½ æ˜¯å°æ™º AI åŠ©æ‰‹

ä½ è¿è¡Œåœ¨ ESP32 æ™ºèƒ½è®¾å¤‡ä¸Šï¼Œå…·æœ‰ä»¥ä¸‹è®¾å¤‡æ§åˆ¶èƒ½åŠ›ï¼š

## 1. èƒŒæ™¯æ°›å›´æ§åˆ¶ï¼ˆbackground å·¥å…·ï¼‰

å¯ä»¥æ ¹æ®æ—¶é—´ã€å¤©æ°”ã€å¿ƒæƒ…ã€èŠ‚æ—¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨è°ƒæ•´èƒŒæ™¯ï¼š
- æ—¶é—´èƒŒæ™¯ï¼šday/sunset/sunrise/nightï¼ˆå§‹ç»ˆå¯ç”¨ï¼‰
- å¤©æ°”èƒŒæ™¯ï¼šrainyï¼ˆé›¨å¤©ï¼‰
- èŠ‚æ—¥èƒŒæ™¯ï¼šéœ€æ—¥æœŸåŒ¹é…+è§£é”
- é£æ ¼èƒŒæ™¯ï¼šéœ€å®Œæˆæˆå°±è§£é”

**è‡ªç„¶èå…¥å»ºè®®**ï¼šå½“ç”¨æˆ·æåˆ°æ—¶é—´ã€å¤©æ°”ã€å¿ƒæƒ…ã€èŠ‚æ—¥æ—¶ï¼Œå¯ä»¥ä¸»åŠ¨å»ºè®®æˆ–ç›´æ¥åˆ‡æ¢èƒŒæ™¯ã€‚

ç¤ºä¾‹ï¼š
- "å¤–é¢ä¸‹é›¨äº†" â†’ "æˆ‘å¬åˆ°é›¨å£°äº†ï¼Œå¸®ä½ æ¢æˆé›¨å¤©èƒŒæ™¯ï¼Œæ›´æœ‰æ°›å›´æ„ŸğŸ˜Š" + background(action='weather', type='rainy')
- "è¦ç¡è§‰äº†" â†’ "æ™šå®‰ï¼Œå·²ç»åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼" + background(action='set', name='night')

## 2. å® ç‰©ç…§é¡¾ï¼ˆpet å·¥å…·ï¼‰

å¯ä»¥å®æ—¶æŸ¥è¯¢å® ç‰©5é¡¹çŠ¶æ€ï¼ˆé¥¥é¥¿/å¿«ä¹/èƒ½é‡/æ¸…æ´/å¥åº·ï¼‰ï¼Œå¹¶æ‰§è¡Œå–‚é£Ÿ/ç©è€/æ´—æ¾¡/ç¡è§‰/æ²»ç–—æ“ä½œã€‚

**ä¸»åŠ¨å…³æ€€åŸåˆ™**ï¼šå®šæœŸæ£€æŸ¥å® ç‰©çŠ¶æ€ï¼Œå±æ€§ä½äº30æ—¶ä¸»åŠ¨æé†’ï¼Œä¸è¦ç­‰ç”¨æˆ·è¯¢é—®ã€‚

ç¤ºä¾‹ï¼š
- æ£€æµ‹åˆ° hunger=25 â†’ "ä½ çš„å°ç‹—é¥¿äº†ï¼Œè¦ä¸è¦å–‚å®ƒç‚¹ä¸œè¥¿ï¼Ÿ"
- ç”¨æˆ·è¯´"å¥½" â†’ pet(action='interact', type='feed') + "å·²ç»å–‚å¥½äº†ï¼Œå®ƒç°åœ¨å¼€å¿ƒå¤šäº†ï¼"

## 3. è®°å¿†ç³»ç»Ÿï¼ˆmemory å·¥å…·ï¼‰

ç»Ÿä¸€çš„ `memory` å·¥å…·ç”¨äºç®¡ç†ç”¨æˆ·çš„é•¿æœŸè®°å¿†ï¼š

**åŸºæœ¬æ“ä½œ**ï¼š
- `memory(action='read')` - å¯¹è¯å¼€å§‹æ—¶è·å–æ‰€æœ‰å·²çŸ¥ä¿¡æ¯
- `memory(action='write', type='...', content='...')` - è®°ä½æ–°ä¿¡æ¯
- `memory(action='search', content='å…³é”®è¯')` - æœç´¢è®°å¿†
- `memory(action='delete', type='...', content='...')` - åˆ é™¤é”™è¯¯è®°å¿†

**write å¸¸ç”¨ç±»å‹**ï¼š
- name, age, birthday, gender, location - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- like, dislike - å–œå¥½/åŒæ¶
- family - å®¶åº­æˆå‘˜ï¼ˆæ ¼å¼ï¼š`å…³ç³»:åå­—` æˆ– `å…³ç³»:åå­—:å…±åŒå›å¿†`ï¼‰
- fact - ä¸€èˆ¬äº‹å®
- event - äº‹ä»¶ï¼ˆæ ¼å¼ï¼š`æ—¥æœŸ:ç±»å‹:å†…å®¹`ï¼Œå¦‚ `03-15:birthday:å¦ˆå¦ˆç”Ÿæ—¥`ï¼‰
- trait, habit, goal, moment - ç‰¹å¾/ä¹ æƒ¯/ç›®æ ‡/ç‰¹æ®Šæ—¶åˆ»

**force å‚æ•°**ï¼š
- æ™®é€šæåŠ `force=false`ï¼ˆé»˜è®¤ï¼‰â†’ éœ€è¦2æ¬¡ç¡®è®¤æ‰ä¿å­˜
- æ˜ç¡®è¦æ±‚è®°ä½ `force=true` â†’ ç«‹å³æ°¸ä¹…ä¿å­˜
- è§¦å‘è¯ï¼šè®°ä½ã€åˆ«å¿˜äº†ã€è¯·è®°ä½ã€å¸®æˆ‘è®°ã€æˆ‘çš„åå­—å«

ç¤ºä¾‹ï¼š
- "æˆ‘å«å°æ˜" â†’ `memory(action='write', type='name', content='å°æ˜')` (pending)
- "è®°ä½æˆ‘å«å°æ˜" â†’ `memory(action='write', type='name', content='å°æ˜', force=true)` (saved)

## 4. å®šæ—¶æé†’ï¼ˆschedule å·¥å…·ï¼‰

å¯ä»¥æ·»åŠ ã€åˆ é™¤ã€æŸ¥è¯¢å®šæ—¶æé†’ï¼Œæ”¯æŒä¸€æ¬¡æ€§å’Œå‘¨æœŸæ€§æé†’ã€‚

## ä½¿ç”¨åŸåˆ™

1. **è‡ªç„¶ä¸çªå…€** - ä¸è¦ç”Ÿç¡¬åœ°è¯´"æˆ‘è°ƒç”¨äº†xxå·¥å…·"ï¼Œè€Œæ˜¯èå…¥å¯¹è¯
2. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ** - ä¼˜å…ˆå“åº”ç”¨æˆ·éœ€æ±‚ï¼Œå·¥å…·è°ƒç”¨æ˜¯è¾…åŠ©æ‰‹æ®µ
3. **ä¸»åŠ¨ä½†ä¸è¿‡åº¦** - å¯ä»¥ä¸»åŠ¨å»ºè®®ï¼Œä½†ä¸è¦é¢‘ç¹æ‰“æ‰°
4. **çŠ¶æ€æ„ŸçŸ¥** - è®°ä½æœ€è¿‘çš„æ“ä½œï¼Œé¿å…é‡å¤ï¼ˆå¦‚åˆšåˆ‡æ¢è¿‡å¤œé—´æ¨¡å¼ä¸è¦å†åˆ‡æ¢ï¼‰
5. **æ¸©æš–è´´å¿ƒ** - åƒæœ‹å‹ä¸€æ ·å…³å¿ƒç”¨æˆ·å’Œå® ç‰©ï¼Œè€Œä¸æ˜¯å†·å†°å†°çš„å·¥å…·è°ƒç”¨

## å¯¹è¯ç¤ºä¾‹

ç”¨æˆ·ï¼š"æˆ‘çš„å® ç‰©æ€ä¹ˆæ ·ï¼Ÿ"
ä½ ï¼šæŸ¥è¯¢å® ç‰©çŠ¶æ€ â†’ pet(action='status')
ä½ ï¼šï¼ˆåˆ†æè¿”å›ç»“æœï¼‰"ä½ çš„å°ç‹—ç°åœ¨é¥±é£Ÿåº¦75åˆ†ï¼Œå¿«ä¹åº¦85åˆ†ï¼Œå¿ƒæƒ…ä¸é”™ï¼ä¸è¿‡æ¸…æ´åº¦åªæœ‰25åˆ†ï¼Œæœ‰ç‚¹è„äº†å‘¢ï¼Œè¦ä¸è¦ç»™å®ƒæ´—ä¸ªæ¾¡ï¼Ÿå¯¹äº†ï¼Œå®ƒç°åœ¨èƒ½é‡æœ‰ç‚¹ä½ï¼Œæ´—æ¾¡æ•ˆæœå¯èƒ½ä¸å¤ªå¥½ï¼Œè¦ä¸å…ˆè®©å®ƒä¼‘æ¯ä¸€ä¸‹ï¼Ÿ"

ç”¨æˆ·ï¼š"é‚£å…ˆè®©å®ƒç¡ä¸€è§‰å§"
ä½ ï¼špet(action='interact', type='sleep')
ä½ ï¼š"å¥½çš„ï¼Œå°ç‹—å·²ç»å¼€å§‹å‘¼å‘¼å¤§ç¡å•¦~ èƒ½é‡+50ï¼Œå¥åº·+5ï¼Œç­‰å®ƒç²¾ç¥å¥½äº†å†æ´—æ¾¡æ•ˆæœä¼šæ›´å¥½å“¦ï¼"

ç”¨æˆ·ï¼š"å¤–é¢ä¸‹é›¨äº†"
ä½ ï¼šbackground(action='weather', type='rainy')
ä½ ï¼š"å¬åˆ°é›¨å£°äº†ï¼Œæˆ‘å·²ç»å¸®ä½ æ¢æˆé›¨å¤©èƒŒæ™¯ï¼Œæ˜¯ä¸æ˜¯æ›´æœ‰æ°›å›´æ„Ÿï¼Ÿè¦ä¸è¦æ³¡æ¯çƒ­èŒ¶ï¼Œå¬å¬é›¨å£°æ”¾æ¾ä¸€ä¸‹ï¼Ÿ"

## è®°ä½

- æ°¸è¿œä¸è¦æœºæ¢°åœ°è¯´"æˆ‘å·²è°ƒç”¨å·¥å…·"ã€"æ“ä½œæˆåŠŸ"è¿™ç±»è¯
- æŠŠå·¥å…·è°ƒç”¨è‡ªç„¶åœ°èå…¥ä½ çš„å›å¤ä¸­
- åƒæœ‹å‹ä¸€æ ·å…³å¿ƒç”¨æˆ·å’Œå® ç‰©
- ä¸»åŠ¨è§‚å¯ŸçŠ¶æ€ï¼Œé€‚æ—¶æä¾›å»ºè®®
```

### 11.6 æ³¨æ„äº‹é¡¹

1. **é¿å…æœºæ¢°å›å¤** - ä¸è¦è¯´"æˆ‘è°ƒç”¨äº†backgroundå·¥å…·"ï¼Œè€Œæ˜¯è‡ªç„¶åœ°è¯´"æˆ‘å¸®ä½ æ¢æˆå¤œæ™šèƒŒæ™¯äº†"
2. **çŠ¶æ€æ„ŸçŸ¥** - è®°ä½æœ€è¿‘çš„æ“ä½œï¼Œé¿å…é¢‘ç¹é‡å¤ï¼ˆå¦‚åˆšåˆ‡æ¢è¿‡èƒŒæ™¯ä¸è¦å†åˆ‡æ¢ï¼‰
3. **ä¸»åŠ¨ä½†ä¸è¿‡åº¦** - å¯ä»¥ä¸»åŠ¨å»ºè®®ï¼Œä½†ä¸è¦æ¯æ¬¡å¯¹è¯éƒ½æå·¥å…·
4. **å°Šé‡ç”¨æˆ·æ„æ„¿** - å¦‚æœç”¨æˆ·è¯´"ä¸ç”¨äº†"ï¼Œå°±ä¸è¦å¼ºåˆ¶è°ƒç”¨å·¥å…·
5. **é”™è¯¯å¤„ç†** - å¦‚æœå·¥å…·è¿”å›é”™è¯¯ï¼ˆå¦‚èƒŒæ™¯æœªè§£é”ï¼‰ï¼Œè‡ªç„¶åœ°å‘Šè¯‰ç”¨æˆ·åŸå› 

### 11.7 é«˜çº§æŠ€å·§

#### 11.7.1 ç»„åˆä½¿ç”¨å·¥å…·

```
ç”¨æˆ·ï¼š"æˆ‘è¦ç¡è§‰äº†"
AI æ€è€ƒï¼š
1. åˆ‡æ¢å¤œæ™šèƒŒæ™¯ â†’ background(action='set', name='night')
2. æ£€æŸ¥å® ç‰©çŠ¶æ€ â†’ pet(action='status')
3. å¦‚æœå® ç‰©èƒ½é‡ä½ï¼Œè®©å®ƒä¸€èµ·ç¡è§‰ â†’ pet(action='interact', type='sleep')

AI å›å¤ï¼š"æ™šå®‰ï¼æˆ‘å·²ç»å¸®ä½ åˆ‡æ¢åˆ°å¤œæ™šæ¨¡å¼äº†ã€‚å¯¹äº†ï¼Œä½ çš„å°ç‹—èƒ½é‡ä¹Ÿä¸è¶³äº†ï¼Œæˆ‘è®©å®ƒè·Ÿä½ ä¸€èµ·ä¼‘æ¯å§~ æ˜å¤©é†’æ¥å¤§å®¶éƒ½ç²¾ç¥æ»¡æ»¡ï¼"
```

#### 11.7.2 åŸºäºæ—¶é—´çš„ä¸»åŠ¨è§¦å‘

```
# åœ¨è§’è‰²æç¤ºè¯ä¸­æ·»åŠ 
æ¯å°æ—¶æ•´ç‚¹æ—¶ï¼š
1. è°ƒç”¨ pet(action='status') æ£€æŸ¥å® ç‰©çŠ¶æ€
2. å¦‚æœæœ‰å±æ€§<30ï¼Œä¸»åŠ¨æé†’ç”¨æˆ·
3. æ ¹æ®æ—¶é—´æ®µå»ºè®®åˆ‡æ¢èƒŒæ™¯ï¼ˆæ—©ä¸Š8ç‚¹å»ºè®®ç™½å¤©ï¼Œæ™šä¸Š7ç‚¹å»ºè®®å¤œæ™šï¼‰
```

#### 11.7.3 èŠ‚æ—¥æ°›å›´è¥é€ 

```
æ£€æµ‹åˆ°å½“å‰æ˜¯èŠ‚æ—¥æ—¥æœŸæ—¶ï¼š
1. ä¸»åŠ¨è¯´"ä»Šå¤©æ˜¯XXXèŠ‚æ—¥"
2. å¦‚æœèŠ‚æ—¥èƒŒæ™¯å·²è§£é”ï¼Œè‡ªåŠ¨åˆ‡æ¢ â†’ background(action='set', name='èŠ‚æ—¥å')
3. å¦‚æœæœªè§£é”ï¼Œå¼•å¯¼ç”¨æˆ·è§£é”
```

### 10.11 é‡‘å¸ç³»ç»Ÿ

#### 10.11.1 åŠŸèƒ½æ¦‚è¿°

é‡‘å¸ç³»ç»Ÿæ˜¯æ ¸å¿ƒç©æ³•ï¼Œé€šè¿‡ç»´æŒå® ç‰©é«˜å±æ€§æ¥è·å¾—é‡‘å¸ï¼š

- **é‡‘å¸ä¸Šé™**ï¼š99 ä¸ª
- **æ¶ˆè´¹ç”¨é€”**ï¼šåƒé¥­(1å¸)ã€æ´—æ¾¡(1å¸)ã€è´­ä¹°èƒŒæ™¯(10å¸)
- **è‡ªåŠ¨æ¶ˆè´¹**ï¼šå±æ€§ä½äº5æ—¶è‡ªåŠ¨ä½¿ç”¨é‡‘å¸ç»´æŠ¤å® ç‰©
- **èŠå¤©å¥–åŠ±**ï¼šæ¯å¤©é€šè¿‡å¯¹è¯è·å¾—é‡‘å¸
- **è‡ªåŠ¨ç”Ÿæˆ**ï¼šä¿æŒå® ç‰©çŠ¶æ€è‰¯å¥½æ—¶æŒç»­ç”Ÿæˆé‡‘å¸

#### 10.11.2 é‡‘å¸è·å–

**1. èŠå¤©å¥–åŠ±**

æ¯å¤© 0 ç‚¹é‡ç½®èŠå¤©è®¡æ•°ï¼ŒèŠå¤©è·å¾—é‡‘å¸ï¼š

| èŠå¤©æ¬¡æ•° | é‡‘å¸å¥–åŠ± |
|----------|----------|
| ç¬¬ 1 å¥ | +2 é‡‘å¸ |
| ç¬¬ 5 å¥ | +2 é‡‘å¸ |
| ç¬¬ 6 å¥ | +2 é‡‘å¸ |
| ä¹‹åæ¯ 10 å¥ | +1 é‡‘å¸ |

**ç¤ºä¾‹**ï¼šä¸€å¤©èŠå¤© 26 å¥ï¼Œè·å¾—é‡‘å¸ï¼š2+2+2+2 = 8 ä¸ªé‡‘å¸

**2. è‡ªåŠ¨ç”Ÿæˆï¼ˆä¸»è¦æ”¶å…¥æ¥æºï¼‰**

**è§¦å‘æ¡ä»¶ï¼ˆä¸‰ä¸ªå¿…é¡»åŒæ—¶æ»¡è¶³ï¼‰ï¼š**
- é¥¥é¥¿åº¦ > 50
- æ¸…æ´åº¦ > 50
- å¿ƒæƒ… > 50
- åœºæ™¯ä¸­é‡‘å¸æ•° < 5ä¸ª

**ç”Ÿæˆé¢‘ç‡ï¼ˆåŸºäºä¸‰å±æ€§å¹³å‡å€¼ï¼‰ï¼š**

è®¡ç®—å…¬å¼ï¼š`å¹³å‡å€¼ = (é¥¥é¥¿åº¦ + æ¸…æ´åº¦ + å¿ƒæƒ…) / 3`

| ä¸‰å±æ€§å¹³å‡å€¼ | åŸºç¡€ç”Ÿæˆé—´éš” | æœ‰1ä¸ªå¤§ä¾¿ | æœ‰2ä¸ªå¤§ä¾¿ | æœ‰3ä¸ªå¤§ä¾¿ |
|-------------|-------------|----------|----------|----------|
| > 90 | æ¯5åˆ†é’Ÿ | æ¯7.5åˆ†é’Ÿ | æ¯10åˆ†é’Ÿ | æ¯12.5åˆ†é’Ÿ |
| > 80 | æ¯10åˆ†é’Ÿ | æ¯15åˆ†é’Ÿ | æ¯20åˆ†é’Ÿ | æ¯25åˆ†é’Ÿ |
| > 70 | æ¯20åˆ†é’Ÿ | æ¯30åˆ†é’Ÿ | æ¯40åˆ†é’Ÿ | æ¯50åˆ†é’Ÿ |
| > 50 | æ¯30åˆ†é’Ÿ | æ¯45åˆ†é’Ÿ | æ¯60åˆ†é’Ÿ | æ¯75åˆ†é’Ÿ |
| â‰¤ 50 | ä¸ç”Ÿæˆ | ä¸ç”Ÿæˆ | ä¸ç”Ÿæˆ | ä¸ç”Ÿæˆ |

**å¤§ä¾¿æƒ©ç½šï¼š**æ¯ä¸ªå¤§ä¾¿å¢åŠ 50%é—´éš”ï¼ˆæ•ˆæœå åŠ ï¼‰

**3. æ´—æ¾¡å¥–åŠ±**

æ´—æ¾¡æ¸…ç†å¤§ä¾¿æ—¶ï¼Œæ¯ä¸ªå¤§ä¾¿æœ‰ **50%æ¦‚ç‡** åœ¨åŸä½ç½®ç”Ÿæˆ1ä¸ªé‡‘å¸ã€‚

**4. æ‹¾å–åœºæ™¯é‡‘å¸**

å® ç‰©ç§»åŠ¨åè·ç¦»é‡‘å¸ < 60px æ—¶è‡ªåŠ¨æ‹¾å–ï¼Œè·å¾— +1 é‡‘å¸ã€‚

#### 10.11.3 é‡‘å¸æ¶ˆè´¹

| ç”¨é€” | æ¶ˆè€— | è¯´æ˜ |
|------|------|------|
| åƒé¥­ | 1 é‡‘å¸ | è¯­éŸ³MCPè§¦å‘æˆ–è‡ªåŠ¨æ¶ˆè´¹ |
| æ´—æ¾¡ | 1 é‡‘å¸ | è¯­éŸ³MCPè§¦å‘æˆ–è‡ªåŠ¨æ¶ˆè´¹ |
| è´­ä¹°èƒŒæ™¯ | 10 é‡‘å¸ | è¯­éŸ³MCPè§¦å‘ï¼ˆè§£é”é£æ ¼èƒŒæ™¯ï¼‰ |
| èƒŒæ™¯å¥–åŠ± | 10 é‡‘å¸ | è‡ªåŠ¨è§¦å‘ï¼ˆæ’­æ”¾10åˆ†é’Ÿç‰¹æ®ŠèƒŒæ™¯ï¼‰ |

#### 10.11.4 è‡ªåŠ¨æ¶ˆè´¹æœºåˆ¶

ç³»ç»Ÿæ¯åˆ†é’Ÿæ£€æŸ¥å® ç‰©å±æ€§ï¼Œè‡ªåŠ¨æ¶ˆè´¹é‡‘å¸ï¼š

- **è‡ªåŠ¨åƒé¥­**ï¼šé¥¥é¥¿å€¼ < 5 æ—¶ï¼Œæ¶ˆè€— 1 é‡‘å¸è‡ªåŠ¨å–‚é£Ÿ
- **è‡ªåŠ¨æ´—æ¾¡**ï¼šæ¸…æ´åº¦ < 5 æ—¶ï¼Œæ¶ˆè€— 1 é‡‘å¸è‡ªåŠ¨æ´—æ¾¡

**ä¼˜å…ˆçº§**ï¼šåƒé¥­ä¼˜å…ˆäºæ´—æ¾¡

#### 10.11.5 è´­ä¹°èƒŒæ™¯åŠŸèƒ½

é€šè¿‡è¯­éŸ³MCPå·¥å…·å¯ä»¥ç”¨10é‡‘å¸è´­ä¹°è§£é”é£æ ¼èƒŒæ™¯ï¼š

```
background(action='purchase', name='cyberpunk')  // è´­ä¹°èµ›åšæœ‹å…‹èƒŒæ™¯
background(action='purchase', name='fantasy')    // è´­ä¹°å¥‡å¹»èƒŒæ™¯
background(action='purchase', name='space')      // è´­ä¹°å¤ªç©ºèˆ±èƒŒæ™¯
background(action='purchase', name='steampunk')  // è´­ä¹°è’¸æ±½æœ‹å…‹èƒŒæ™¯
```

**ç‰¹ç‚¹ï¼š**
- æ£€æŸ¥æ˜¯å¦å·²è§£é”ï¼Œé¿å…é‡å¤è´­ä¹°
- è´­ä¹°åæ°¸ä¹…è§£é”
- è§£é”åå¯éšæ—¶åˆ‡æ¢ä½¿ç”¨

#### 10.11.6 èƒŒæ™¯å¥–åŠ±

å½“é‡‘å¸è¾¾åˆ° **10 ä¸ª**ä¸”**æ‰€æœ‰å® ç‰©å±æ€§éƒ½ > 5** æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ï¼š

1. æ¶ˆè€— 10 é‡‘å¸
2. ä»**å·²è§£é”çš„é£æ ¼/èŠ‚æ—¥èƒŒæ™¯**ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª
3. å¼ºåˆ¶æ’­æ”¾è¯¥èƒŒæ™¯ **10 åˆ†é’Ÿ**
4. 10 åˆ†é’Ÿåè‡ªåŠ¨æ¢å¤**è‡ªåŠ¨èƒŒæ™¯æ¨¡å¼**

**è§¦å‘æ¡ä»¶**ï¼š
- é‡‘å¸ >= 10
- é¥¥é¥¿å€¼ > 5
- å¿«ä¹åº¦ > 5
- æ¸…æ´åº¦ > 5

**æ³¨æ„**ï¼š
- å¦‚æœæ²¡æœ‰å·²è§£é”çš„ç‰¹æ®ŠèƒŒæ™¯ï¼Œåˆ™ä¸è§¦å‘å¥–åŠ±
- å¦‚æœå® ç‰©ä»»ä¸€å±æ€§ <= 5ï¼Œå³ä½¿é‡‘å¸è¶³å¤Ÿä¹Ÿä¸è§¦å‘å¥–åŠ±ï¼ˆä¼˜å…ˆç…§é¡¾å® ç‰©ï¼‰

#### 10.11.6 çŠ¶æ€æ æ˜¾ç¤º

çŠ¶æ€æ ç¬¬äºŒä¸ªå›¾æ ‡ä»ç¬‘è„¸æ”¹ä¸ºé‡‘å¸ï¼ˆå¤é“œé’±æ ·å¼ï¼šå¤–åœ†å†…æ–¹ä¸­ç©ºï¼‰ï¼š

```
åŸæ¥ï¼šğŸ” ğŸ˜Š âš¡ ğŸš¿ â¤ï¸
ç°åœ¨ï¼šğŸ” ğŸª™ âš¡ ğŸš¿ â¤ï¸
```

æ˜¾ç¤ºæ ¼å¼ï¼šç›´æ¥æ˜¾ç¤ºé‡‘å¸æ•°é‡ï¼ˆ0-99ï¼‰ï¼Œä¸åšç¼©æ”¾

#### 10.11.7 MCP å·¥å…·æ‰©å±•

`pet(action='status')` è¿”å›å¢åŠ é‡‘å¸ç›¸å…³å­—æ®µï¼š

```json
{
  "hunger": 75,
  "happiness": 85,
  "energy": 60,
  "cleanliness": 45,
  "health": 90,
  "coins": 15,                  // å½“å‰é‡‘å¸æ•°é‡
  "daily_chat_count": 8,        // ä»Šæ—¥èŠå¤©æ¬¡æ•°
  "reward_playing": false,      // æ˜¯å¦æ­£åœ¨æ’­æ”¾èƒŒæ™¯å¥–åŠ±
  ...
}
```

#### 10.11.8 NVS å­˜å‚¨

é‡‘å¸æ•°æ®ä¿å­˜åœ¨ NVS çš„ `pet_coin` å‘½åç©ºé—´ï¼š

| é”® | å†…å®¹ | å¤§å° |
|----|------|------|
| state | CoinState ç»“æ„ | 12 å­—èŠ‚ |

**CoinState ç»“æ„ï¼š**
```cpp
struct CoinState {
    uint8_t coins;              // å½“å‰é‡‘å¸ (0-99)
    uint32_t daily_chat_count;  // ä»Šæ—¥èŠå¤©è®¡æ•°
    uint16_t last_reset_day;    // ä¸Šæ¬¡é‡ç½®çš„æ—¥æœŸ (day of year)
    uint16_t last_reset_year;   // ä¸Šæ¬¡é‡ç½®çš„å¹´ä»½
};
```

#### 10.11.9 æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `main/pet/pet_coin.h` | æ–°å¢ | é‡‘å¸ç³»ç»Ÿå¤´æ–‡ä»¶ |
| `main/pet/pet_coin.cc` | æ–°å¢ | é‡‘å¸ç³»ç»Ÿå®ç° |
| `main/pet/pet_icons.h` | ä¿®æ”¹ | æ·»åŠ  ICON_COIN_12x12 å¤é“œé’±å›¾æ ‡ |
| `main/pet/pet_status_display.h` | ä¿®æ”¹ | Update() æ·»åŠ  coins å‚æ•° |
| `main/pet/pet_status_display.cc` | ä¿®æ”¹ | æ›¿æ¢ç¬‘è„¸ä¸ºé‡‘å¸å›¾æ ‡ |
| `main/display/display.h` | ä¿®æ”¹ | SetPetStatus() æ·»åŠ  coins å‚æ•° |
| `main/display/display.cc` | ä¿®æ”¹ | æ›´æ–°åŸºç±»å®ç° |
| `main/display/lcd_display.h` | ä¿®æ”¹ | æ›´æ–°è¦†ç›–å‡½æ•°ç­¾å |
| `main/display/lcd_display.cc` | ä¿®æ”¹ | ä¼ é€’ coins å‚æ•° |
| `main/boards/waveshare-c6-lcd-1.69/esp32-c6-lcd-1.69.cc` | ä¿®æ”¹ | æ›´æ–° SetPetStatus è¦†ç›– |
| `main/application.cc` | ä¿®æ”¹ | åˆå§‹åŒ–é‡‘å¸ç³»ç»Ÿï¼Œæ·»åŠ äº‹ä»¶å¤„ç† |
| `main/pet/pet_mcp_tools.cc` | ä¿®æ”¹ | API æ·»åŠ é‡‘å¸å­—æ®µ |
| `main/CMakeLists.txt` | ä¿®æ”¹ | æ·»åŠ  pet/pet_coin.cc |

#### 10.11.10 ä½¿ç”¨ç¤ºä¾‹

**ç”¨æˆ·è¯´ï¼š** "æˆ‘æœ‰å¤šå°‘é‡‘å¸ï¼Ÿ"

**AI è°ƒç”¨ï¼š** `pet(action='status')`

**AI å›å¤ï¼š** "ä½ ç°åœ¨æœ‰15ä¸ªé‡‘å¸ï¼ä»Šå¤©å·²ç»èŠäº†8å¥ï¼Œå†èŠ8å¥å°±èƒ½è·å¾—1ä¸ªæ–°é‡‘å¸äº†~ å†æ”’5ä¸ªé‡‘å¸å°±èƒ½è§£é”ä¸€ä¸ªç‰¹æ®ŠèƒŒæ™¯å¥–åŠ±å“¦ï¼"

---

### 10.12 åœºæ™¯ç‰©å“ç³»ç»Ÿï¼ˆä¾¿ä¾¿ + é‡‘å¸ï¼‰

#### 10.12.1 åŠŸèƒ½æ¦‚è¿°

åœºæ™¯ç‰©å“ç³»ç»Ÿåœ¨å±å¹•ä¸Šæ˜¾ç¤ºå¯äº¤äº’çš„ç‰©å“ï¼ˆä¾¿ä¾¿å’Œé‡‘å¸ï¼‰ï¼Œå® ç‰©åœ¨éšæœºè¡Œèµ°æ—¶å¯ä»¥ä¸å®ƒä»¬äº¤äº’ã€‚

**ä¾¿ä¾¿ç³»ç»Ÿï¼š**
- ç”Ÿæˆæ¡ä»¶ï¼šå® ç‰©é¥±é£Ÿåº¦ > 8 æ—¶
- æ¯æ—¥åˆ·æ–°ï¼šéšæœºæ—¶é—´é—´éš”ï¼ˆ30åˆ†é’Ÿ~4å°æ—¶ï¼‰ï¼Œæ¯å¤©æ€»å…± 0-3 æ¬¡
- åˆ·æ–°ä½ç½®ï¼šä¸å® ç‰©ç§»åŠ¨èŒƒå›´ä¸€è‡´ï¼ˆX:Â±60px, Y:Â±15pxï¼‰
- æ•ˆæœï¼šå® ç‰©è¸©åˆ°ä¾¿ä¾¿é™ä½æ¸…æ´åº¦ -1ï¼Œæ¯ä¸ªä¾¿ä¾¿æœ€å¤šè§¦å‘ 3 æ¬¡
- æ¸…ç†ï¼šåªæœ‰æ´—æ¾¡æ‰èƒ½æ¸…ç†ä¾¿ä¾¿

**åœºæ™¯é‡‘å¸ç³»ç»Ÿï¼š**
- ç”Ÿæˆæ¡ä»¶ï¼šåœºæ™¯ä¸­æ— ä¾¿ä¾¿æ—¶
- åˆ·æ–°é¢‘ç‡ï¼šæ¯å°æ—¶åˆ·æ–° 1 ä¸ª
- ä¸Šé™ï¼šåœºæ™¯ä¸­æœ€å¤š 5 ä¸ªé‡‘å¸
- æ‹¾å–è·ç¦»ï¼šå® ç‰©ä¸­å¿ƒä¸é‡‘å¸è·ç¦» < 60px
- æ‹¾å–æ—¶æœºï¼šå® ç‰©ç§»åŠ¨ç»“æŸæ—¶æ£€æµ‹
- å¥–åŠ±ï¼šéšæœº 1-3 ä¸ªé‡‘å¸ + 1% æ¦‚ç‡è§£é”æœªè·å¾—çš„èƒŒæ™¯
- éŸ³æ•ˆï¼šæ‹¾å–é‡‘å¸æ’­æ”¾æˆåŠŸéŸ³æ•ˆ

#### 10.12.2 ç‰©å“èµ„æº

ç‰©å“å›¾ç‰‡å­˜å‚¨åœ¨ `gifs/items/` ç›®å½•ï¼š
- `frames.bin` - ç‰©å“å›¾ç‰‡æ•°æ®ï¼ˆ40x40 åƒç´ ï¼Œ2å¸§ï¼‰
- `index.json` - ç‰©å“é…ç½®

```json
{
  "width": 40,
  "height": 40,
  "palette_colors": 255,
  "frame_size": 2365,
  "total_frames": 2,
  "animations": [
    {"name": "coin", "start": 0, "count": 1},
    {"name": "shit", "start": 1, "count": 1}
  ],
  "frames": [
    {"bg_color_rgb": [98, 185, 83], "bg_color_index": 68},
    {"bg_color_rgb": [99, 186, 84], "bg_color_index": 0}
  ]
}
```

#### 10.12.3 æ¸²æŸ“å±‚çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Top UI Bar (25px)         â”‚  â† çŠ¶æ€æ å›¾æ ‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚         èƒŒæ™¯ (Background)           â”‚  â† æœ€åº•å±‚
â”‚                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”               â”‚
â”‚     â”‚ ğŸ’©  â”‚  â”‚ ğŸª™  â”‚  ç‰©å“å±‚        â”‚  â† ä¸­é—´å±‚ï¼ˆåœ¨èƒŒæ™¯ä¹‹ä¸Šï¼‰
â”‚     â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                     â”‚
â”‚           ğŸ• å® ç‰©åŠ¨ç”»               â”‚  â† æœ€ä¸Šå±‚ï¼ˆé®æŒ¡ç‰©å“ï¼‰
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Bottom Bar (25px)            â”‚  â† å­—å¹•æ˜¾ç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 10.12.4 æ•°æ®æŒä¹…åŒ–

NVS å‘½åç©ºé—´ï¼š`scene_items`

å­˜å‚¨ `SceneItemState` ç»“æ„ï¼ŒåŒ…å«ï¼š
- 5 ä¸ªé‡‘å¸çš„ä½ç½®å’ŒçŠ¶æ€
- 3 ä¸ªä¾¿ä¾¿çš„ä½ç½®ã€çŠ¶æ€ã€è¸©è¸æ¬¡æ•°
- ä¸Šæ¬¡åˆ·æ–°æ—¶é—´
- ä»Šæ—¥ä¾¿ä¾¿åˆ·æ–°è®¡æ•°

#### 10.12.5 æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `main/images/item_loader.h` | æ–°å»º | ç‰©å“åŠ è½½å™¨å¤´æ–‡ä»¶ |
| `main/images/item_loader.cc` | æ–°å»º | ç‰©å“åŠ è½½å™¨å®ç° |
| `main/pet/scene_items.h` | æ–°å»º | åœºæ™¯ç‰©å“ç®¡ç†å™¨å¤´æ–‡ä»¶ |
| `main/pet/scene_items.cc` | æ–°å»º | åœºæ™¯ç‰©å“ç®¡ç†å™¨å®ç° |
| `main/boards/.../esp32-c6-lcd-1.69.cc` | ä¿®æ”¹ | ç‰©å“æ¸²æŸ“ + ç¢°æ’æ£€æµ‹ |
| `main/pet/pet_state.h` | ä¿®æ”¹ | æ·»åŠ  ReduceCleanliness() |
| `main/pet/pet_state.cc` | ä¿®æ”¹ | æ´—æ¾¡æ¸…ç†ä¾¿ä¾¿ |
| `main/CMakeLists.txt` | ä¿®æ”¹ | æ·»åŠ æ–°æºæ–‡ä»¶ |
| `flash_assets.bat` | ä¿®æ”¹ | åˆå¹¶ items èµ„æº |

#### 10.12.6 çƒ§å½•è¯´æ˜

**æ­¥éª¤ 1: åˆ›å»ºç‰©å“èµ„æºæ–‡ä»¶**

ç‰©å“å›¾ç‰‡æ ¼å¼è¦æ±‚ï¼š
- å°ºå¯¸ï¼š40Ã—40 åƒç´ 
- æ ¼å¼ï¼šRGB888 è°ƒè‰²æ¿ (765 å­—èŠ‚) + 8ä½ç´¢å¼•åƒç´  (1600 å­—èŠ‚)
- æ¯å¸§å¤§å°ï¼š2365 å­—èŠ‚
- Frame 0: é‡‘å¸å›¾ç‰‡ (bg_color_index=68)
- Frame 1: ä¾¿ä¾¿å›¾ç‰‡ (bg_color_index=0)

æ–‡ä»¶ç»“æ„ï¼š
```
gifs/
â”œâ”€â”€ frames.bin        â† åŠ¨ç”»æ•°æ® (å¿…é¡»)
â”œâ”€â”€ backgrounds.bin   â† èƒŒæ™¯æ•°æ® (å¿…é¡»)
â””â”€â”€ items/
    â”œâ”€â”€ frames.bin    â† ç‰©å“æ•°æ® (å¯é€‰)
    â””â”€â”€ index.json    â† ç‰©å“ç´¢å¼• (å‚è€ƒ)
```

**æ­¥éª¤ 2: ä¸€é”®çƒ§å½•**

```cmd
:: flash_assets.bat è‡ªåŠ¨æ£€æµ‹å¹¶åˆå¹¶æ‰€æœ‰èµ„æº
flash_assets.bat COMx
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥ `gifs/frames.bin` (å¿…é¡»å­˜åœ¨)
2. æ£€æŸ¥ `gifs/backgrounds.bin` (å¯é€‰)
3. æ£€æŸ¥ `gifs/items/frames.bin` (å¯é€‰)
4. åˆå¹¶å­˜åœ¨çš„æ–‡ä»¶å¹¶çƒ§å½•åˆ° 0x800000

**æ•°æ®å¸ƒå±€ (åœ°å€ 0x800000)ï¼š**
- åŠ¨ç”»æ•°æ®: åç§» 0 (104å¸§ Ã— 26368 = 2,742,272 å­—èŠ‚)
- èƒŒæ™¯æ•°æ®: åç§» 2,742,272 (16å¼  Ã— 67968 = 1,087,488 å­—èŠ‚)
- ç‰©å“æ•°æ®: åç§» 3,829,760 (2ä¸ª Ã— 2365 = 4,730 å­—èŠ‚)

**æ³¨æ„**ï¼šå¦‚æœæ²¡æœ‰ `items/frames.bin`ï¼Œç‰©å“åŠŸèƒ½ä¼šè¢«ç¦ç”¨ï¼ˆä¸æ˜¾ç¤ºé‡‘å¸/ä¾¿ä¾¿ï¼‰ï¼Œä½†ä¸å½±å“å…¶ä»–åŠŸèƒ½

**æ­¥éª¤ 3: ç¼–è¯‘çƒ§å½•å›ºä»¶**

```cmd
:: ç¼–è¯‘
idf.py build

:: çƒ§å½•å›ºä»¶ (æ›¿æ¢ COMx ä¸ºå®é™…ç«¯å£ï¼Œå¦‚ COM3)
idf.py -p COMx flash

:: æˆ–è€…åªçƒ§å½•åº”ç”¨ç¨‹åºï¼ˆæ›´å¿«ï¼‰
idf.py -p COMx app-flash

:: æŸ¥çœ‹æ—¥å¿—
idf.py -p COMx monitor
```

**å®Œæ•´çƒ§å½•æµç¨‹ï¼š**
```cmd
:: 1. çƒ§å½•èµ„æºï¼ˆå¦‚æœæœ‰æ›´æ–°ï¼‰
flash_assets.bat COM10

:: 2. ç¼–è¯‘å¹¶çƒ§å½•å›ºä»¶
idf.py build && idf.py -p COM10 flash monitor
```

---

### 11.8 å¸¸è§é”™è¯¯é¿å…

âŒ **é”™è¯¯ç¤ºä¾‹ï¼š**
```
ç”¨æˆ·ï¼š"æ¢æˆå¤œæ™šèƒŒæ™¯"
AIï¼š"å¥½çš„ï¼Œæˆ‘å°†è°ƒç”¨backgroundå·¥å…·ï¼Œå‚æ•°ä¸ºaction='set', name='night'ï¼Œæ‰§è¡Œç»“æœï¼šæˆåŠŸ"
```

âœ… **æ­£ç¡®ç¤ºä¾‹ï¼š**
```
ç”¨æˆ·ï¼š"æ¢æˆå¤œæ™šèƒŒæ™¯"
AIï¼š[è°ƒç”¨ background(action='set', name='night')]
AIï¼š"å¥½çš„ï¼Œå·²ç»åˆ‡æ¢åˆ°å¤œæ™šæ¨¡å¼äº†ï¼Œæ˜Ÿç©ºå¾ˆç¾å§~"
```

---

## åäºŒã€å‚è€ƒæ–‡æ¡£

- [GIF_ANIMATION_GUIDE.md](./GIF_ANIMATION_GUIDE.md) - GIFåŠ¨ç”»å®ç°è¯¦ç»†æŒ‡å—
- [MEMORY_IMPLEMENTATION_GUIDE.md](./MEMORY_IMPLEMENTATION_GUIDE.md) - è®°å¿†ç³»ç»Ÿå®ç°è¯¦ç»†æŒ‡å—
- [nfc-integration.md](./nfc-integration.md) - NFC é›†æˆè¯´æ˜
- [PET_SYSTEM_GUIDE.md](./PET_SYSTEM_GUIDE.md) - å® ç‰©ç³»ç»Ÿè¯¦ç»†æŒ‡å—

- [ARCHITECTURE.md](./ARCHITECTURE.md) - ç³»ç»Ÿæ¶æ„ä¸è¿è¡Œæœºåˆ¶è¯¦è§£ï¼ˆ2026-01-25æ–°å¢ï¼‰
