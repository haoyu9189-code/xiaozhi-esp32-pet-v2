# WS2811/WS2812 LED 快速开始

## 已完成的集成

✅ WS2811 库已添加到项目中
✅ CMakeLists.txt 已更新
✅ 依赖库 `led_strip` 已存在

## 快速测试

### 1. 在你的代码中包含头文件

```c
#include "ws2811/ws2811.h"
```

### 2. 初始化 LED

```c
// 配置 LED（根据你的硬件修改 GPIO 引脚）
ws2811_config_t config = {
    .gpio_num = 48,          // GPIO 引脚号
    .led_count = 1,          // LED 数量
    .max_brightness = 255,   // 最大亮度
};

// 初始化
ws2811_handle_t led;
esp_err_t ret = ws2811_init(&config, &led);
if (ret != ESP_OK) {
    ESP_LOGE("LED", "Failed to initialize WS2811");
    return;
}
```

### 3. 控制 LED

```c
// 设置为红色
ws2811_set_all(led, WS2811_COLOR_RED);
ws2811_refresh(led);
vTaskDelay(pdMS_TO_TICKS(1000));

// 设置为绿色
ws2811_set_all(led, WS2811_COLOR_GREEN);
ws2811_refresh(led);
vTaskDelay(pdMS_TO_TICKS(1000));

// 设置为蓝色
ws2811_set_all(led, WS2811_COLOR_BLUE);
ws2811_refresh(led);
vTaskDelay(pdMS_TO_TICKS(1000));

// 关闭
ws2811_clear(led);
ws2811_refresh(led);
```

### 4. 释放资源

```c
ws2811_deinit(led);
```

## 完整示例

在 `application.cc` 中添加测试代码：

```c
#include "ws2811/ws2811.h"

void test_ws2811_led(void) {
    ESP_LOGI("LED", "Testing WS2811 LED...");
    
    ws2811_config_t config = {
        .gpio_num = 48,
        .led_count = 1,
        .max_brightness = 255,
    };
    
    ws2811_handle_t led;
    if (ws2811_init(&config, &led) != ESP_OK) {
        ESP_LOGE("LED", "Failed to initialize");
        return;
    }
    
    // 红色
    ws2811_set_all(led, WS2811_COLOR_RED);
    ws2811_refresh(led);
    vTaskDelay(pdMS_TO_TICKS(1000));
    
    // 绿色
    ws2811_set_all(led, WS2811_COLOR_GREEN);
    ws2811_refresh(led);
    vTaskDelay(pdMS_TO_TICKS(1000));
    
    // 蓝色
    ws2811_set_all(led, WS2811_COLOR_BLUE);
    ws2811_refresh(led);
    vTaskDelay(pdMS_TO_TICKS(1000));
    
    // 关闭
    ws2811_clear(led);
    ws2811_refresh(led);
    
    ws2811_deinit(led);
    ESP_LOGI("LED", "Test completed");
}
```

然后在 `Application::Initialize()` 或其他合适的地方调用：

```c
test_ws2811_led();
```

## 硬件连接

```
ESP32          WS2812
-----          ------
GPIO 48  --->  DIN
GND      --->  GND
5V       --->  VCC
```

**注意：**
- 确认你的 GPIO 引脚号（不同板子可能不同）
- 如果有多个 LED，建议使用外部 5V 电源

## 编译和烧录

```bash
idf.py build flash monitor
```

## 更多示例

查看 `ws2811_example.c` 文件，包含：
- 呼吸灯效果
- 彩虹效果
- 闪烁效果
- 追逐效果
- 渐变效果
- 状态指示灯

## 常见问题

### Q: LED 不亮？
1. 检查 GPIO 引脚是否正确
2. 检查电源连接
3. 确认调用了 `ws2811_refresh()`

### Q: 编译错误？
1. 确认 `led_strip` 组件已安装（项目已包含）
2. 确认 CMakeLists.txt 已更新（已完成）

### Q: 如何修改 GPIO 引脚？
修改 `config.gpio_num` 的值即可。

## 下一步

- 查看 `README.md` 了解完整 API
- 查看 `ws2811_example.c` 学习更多效果
- 根据你的需求自定义 LED 效果
