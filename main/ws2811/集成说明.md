# WS2811 LED 集成完成

## 已完成的工作

✅ **库文件创建**
- `ws2811.h` - API 头文件
- `ws2811.c` - 实现文件
- `ws2811_example.c` - 示例代码
- `README.md` - 完整 API 文档
- `快速开始.md` - 快速入门指南

✅ **项目集成**
- 已添加到 `main/CMakeLists.txt`
- 已集成到 `waveshare-c6-lcd-1.69` 板子
- GPIO 9 配置，1 个 LED

✅ **板子集成**
- 在构造函数中调用 `InitializeLed()`
- 添加了 LED 控制方法：
  - `SetLedColor(color)` - 设置颜色
  - `SetLedColorRgb(r, g, b)` - 设置 RGB 颜色
  - `SetLedOff()` - 关闭 LED
  - `SetLedBrightness(brightness)` - 设置亮度
  - `UpdateLedForState(state)` - 根据设备状态自动设置颜色

## 使用方法

### 1. 手动控制 LED

```cpp
auto& board = Board::GetInstance();

// 设置为红色
board.SetLedColor(WS2811_COLOR_RED);

// 设置为自定义颜色
board.SetLedColorRgb(255, 128, 0);  // 橙色

// 关闭
board.SetLedOff();

// 调整亮度
board.SetLedBrightness(128);  // 50% 亮度
```

### 2. 根据设备状态自动控制

```cpp
auto& board = Board::GetInstance();
auto& app = Application::GetInstance();

// 根据当前设备状态设置 LED
board.UpdateLedForState(app.GetDeviceState());
```

**状态颜色映射：**
- `kDeviceStateIdle` → 绿色
- `kDeviceStateListening` → 蓝色
- `kDeviceStateSpeaking` → 青色
- `kDeviceStateConnecting` → 黄色
- `kDeviceStateStarting` → 橙色
- 其他 → 关闭

### 3. 在 Application 中集成（可选）

如果想要自动根据设备状态更新 LED，可以在 `application.cc` 的状态切换处添加：

```cpp
void Application::SetDeviceState(DeviceState state) {
    // ... 现有代码 ...
    
    // 更新 LED 状态
    auto& board = Board::GetInstance();
    board.UpdateLedForState(state);
}
```

## 硬件连接

```
ESP32-C6       WS2812
--------       ------
GPIO 9   --->  DIN
GND      --->  GND
5V       --->  VCC
```

## 测试

编译并烧录：

```bash
idf.py build flash monitor
```

LED 应该在设备启动时初始化并关闭。你可以通过调用上述方法来控制 LED。

## 更多示例

查看 `ws2811_example.c` 了解更多效果：
- 呼吸灯
- 彩虹效果
- 闪烁
- 追逐
- 渐变

## 注意事项

- LED 在 `InitializeLed()` 中初始化并关闭
- 如果初始化失败，`led_strip_` 会被设置为 `nullptr`，所有 LED 方法会安全地忽略操作
- 只有 `waveshare-c6-lcd-1.69` 板子启用了 LED 功能
